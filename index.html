<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>agraj - Portfolio</title>
    <link rel="icon" type="image/png" href="frieren.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+Bhai+2:wght@700&family=Inter:wght@400;500;600;700&family=Lato:ital,wght@0,400;0,700;1,400&family=Outfit:wght@400;500;700&family=Nunito:wght@400;700&family=Fuzzy+Bubbles:wght@400;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>

    <script>
        // Tailwind config from your previous correct version
        window.tailwind.config = { /* ... Tailwind config ... */ };
    </script>

    <style>
        /* CSS from your previous correct version (golden ratio, black bg, grey nav) */
        /* ... All your CSS from the previous response ... */
        :root {
            --page-bg: #000000; 
            --text-main: var(--text-on-black-primary, #EAEAEA); 
            --text-subtle: var(--text-on-black-secondary, #B0B0B0);
            
            --highlight-purple: #9272CE;
            --highlight-purple-hover: #AE8BD5;
            --highlight-purple-lighter: #CBB8E8;

            --nav-bg: var(--nav-bg-light-grey, #E9E9E9); 
            --nav-text: var(--nav-text-dark, #222222); 
            --nav-text-subtle: var(--nav-text-dark-subtle, #555555);
            --nav-quote-bg: var(--nav-quote-bg-on-light, #DDDDDD);
            --nav-link-hover-bg: rgba(146, 114, 206, 0.1); 

            --p5-blob-hue-min: 230; 
            --p5-blob-hue-max: 310;
            --p5-blob-opacity: 4; 
            --bg-overlay-color-1: rgba(146, 114, 206, 0.02); 
            --bg-overlay-color-2: rgba(0, 0, 0, 0.85); 

            --article-bg-color: rgba(20, 20, 22, 0.93);
            --writings-card-bg-color: rgba(25, 15, 40, 0.88);
            --writings-card-hover-bg-color: rgba(45, 35, 60, 0.96);
            --card-border-color: rgba(146, 114, 206, 0.25);
            --card-hover-border-color: rgba(146, 114, 206, 0.45);
        }
        html { scroll-behavior: smooth; }
        body {
            background-color: var(--page-bg); color: var(--text-main); font-family: 'Inter', sans-serif;
            overflow-x: hidden; line-height: 1.6; font-size: 16px;
        }
        #p5-background-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -10; }
        .bg-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 50% 30%, var(--bg-overlay-color-1), var(--bg-overlay-color-2) 70%); z-index: -5; pointer-events:none; }
        .site-container { display: flex; min-height: 100vh; }
        .site-navbar {
            width: 38.2vw; min-width: 300px; max-width: 550px; 
            background-color: var(--nav-bg); border-right: 1px solid #CCCCCC; 
            position: fixed; top: 0; left: 0; height: 100vh;
            padding: 2.5rem calc(2.5rem / 1.618); 
            display: flex; flex-direction: column; justify-content: space-between;
            overflow-y: auto; z-index: 100;
        }
        .navbar-top-content { text-align: center; }
        #navbar-agraj-image {
            width: 70%; max-width: 220px; height: auto;
            margin: 0 auto 1rem; display: block;
        }
        .site-navbar #typewriter {
            min-height: 2.5em; font-size: 0.95rem; color: var(--nav-text-subtle); margin-bottom: 1rem;
            display: inline-block; width: 100%;
        }
        .site-navbar #main-heading-text { min-height: 1.2em; display: inline-block; }
        .site-navbar #blockquote-text { min-height: 3em; display: inline-block; font-size: 0.9rem; }
        .site-navbar .typed-cursor { background-color: var(--highlight-purple); }
        .site-navbar .quote {
            position: relative; border-left: 3px solid var(--highlight-purple); margin-top: 1rem; margin-bottom: 2rem;
            background-color: var(--nav-quote-bg); 
            padding: 0.75rem 1rem; border-radius: 0.375rem; font-size: 0.9rem; color: var(--nav-text-subtle);
        }
        .site-navbar .quote::before {
            content: '"'; position: absolute; top: -10px; left: 5px; font-size: 3rem; 
            color: color-mix(in srgb, var(--nav-text-subtle) 15%, transparent);
            font-family: 'Inter', sans-serif; font-weight: 700;
        }
        .navbar-links a {
            display: block; padding: 0.85rem calc(0.85rem * 1.618); margin-bottom: 0.5rem;
            text-decoration: none; color: var(--nav-text); font-weight: 500;
            border-radius: 0.375rem; transition: background-color 0.2s ease, color 0.2s ease;
            font-size: 1.1rem;
        }
        .navbar-links a:hover { background-color: var(--nav-link-hover-bg); color: var(--highlight-purple); }
        .navbar-links a.active { background-color: var(--highlight-purple); color: white !important; font-weight: 700; }
        .navbar-links a[target="_blank"]::after {
            content: ' \2197'; font-size: 0.7em; vertical-align: super; 
            display: inline-block; margin-left: 2px; opacity: 0.7;
        }
        .navbar-bottom { text-align: center; margin-top:1rem; }
        #navbar-logo-image {
            width: 60px; height: auto; margin: 1.5rem auto 0; 
            cursor: pointer; display: block; opacity: 0.8; transition: opacity 0.2s ease;
        }
        #navbar-logo-image:hover { opacity: 1; }
        .site-content {
            margin-left: 38.2vw; width: calc(100% - 38.2vw);
            padding: 2rem; background-color: var(--page-bg);
        }
        @media (max-width: calc(300px / 0.382)) { .site-content { margin-left: 300px; width: calc(100% - 300px); } }
        @media (min-width: calc(550px / 0.382)) { .site-content { margin-left: 550px; width: calc(100% - 550px); } }
        .page-section { display: none; animation: fadeInPage 0.7s ease-out forwards; }
        .page-section.active-section { display: block; }
        @keyframes fadeInPage { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        h1, h2, h3, h4, h5, h6 { color: var(--highlight-purple); font-weight: 700; }
        .font-serif { font-family: 'Baloo Bhai 2', cursive; }
        .font-outfit { font-family: 'Outfit', sans-serif; }
        ::-webkit-scrollbar { width: 8px; } 
        ::-webkit-scrollbar-track { background: color-mix(in srgb, var(--nav-bg) 70%, transparent); } 
        ::-webkit-scrollbar-thumb { background: color-mix(in srgb, var(--highlight-purple) 60%, transparent); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: color-mix(in srgb, var(--highlight-purple) 80%, transparent); }
        #animated-images-container-wrapper { height: calc(100vh - 4rem); position: relative; }
        #animated-images-container { position: relative; width: 100%; height: 100%; }
        .animated-post-image-bubble {
            position: absolute; border-radius: 50%; overflow: hidden;
            box-shadow: 0 5px 20px color-mix(in srgb, var(--highlight-purple) 20%, #000000 50%), 0 0 8px rgba(0,0,0,0.2); 
            border: 2px solid color-mix(in srgb, var(--highlight-purple-lighter) 30%, transparent); 
            transition: border-color 0.3s ease; opacity: 0;
        }
        .animated-post-image-bubble:hover { border-color: color-mix(in srgb, var(--highlight-purple-hover) 70%, transparent); }
        .animated-post-image-bubble img { width: 100%; height: 100%; object-fit: cover; display: block; }
        #writings-content, #about-content { font-size: 17px; }
        .writing-preview-card { /* ... styles ... */ } .writing-preview-card::before { /* ... styles ... */ } .writing-preview-card:hover { /* ... styles ... */ }
        .writing-preview-card h3 { color: #FFFFFF; /* ... */ } .writing-preview-card .post-meta-info { color: var(--highlight-purple-lighter); }
        .writing-preview-card .excerpt { color: #D1D1D1; } .writing-preview-card a.read-more-link { color: var(--highlight-purple); }
        .writing-preview-card a.read-more-link:hover { color: var(--highlight-purple-hover); }
        #full-articles-container article { /* ... styles ... */ } #full-articles-container article:target { /* ... styles ... */ }
        #full-articles-container .post-meta-info { color: var(--highlight-purple-lighter); }
        a.back-button { /* ... styles ... */ } a.back-button:hover { /* ... styles ... */ }
        hr.separator { /* ... styles ... */ }
        .post-content-html p, .post-content-html span, .post-content-html div, 
        .post-content-html b, .post-content-html strong, .post-content-html i, 
        .post-content-html em, .post-content-html u { color: #D1D1D1; }
        .post-content-html a { color: var(--highlight-purple); } .post-content-html a:hover { color: var(--highlight-purple-hover); }
        .post-content-html blockquote { /* ... styles ... */ }
        .glitch-button { /* ... styles ... */ }
        .progress-container { position: fixed; top: 0; left: 0; width: 100%; height: 3px; z-index: 200; }
        .progress-bar { height: 3px; background: linear-gradient(90deg, var(--highlight-purple), var(--highlight-purple-hover)); width: 0%; }
        #secret-game-modal { background-color: rgba(0,0,0,0.97); /* ... */ }
        #matter-canvas { background-color: rgba(20, 15, 35, 0.4); /* ... */ }
        #game-info { color: var(--highlight-purple-lighter); } #game-win-message { color: var(--highlight-purple-hover); }
        .game-instructions { color: var(--text-on-black-secondary); }
        #about-content .questionnaire-container-wrapper { /* ... */ } .question-block { /* ... */ }
        .question-block h3 { color: #D7C2F2; /* ... */ } .answer-option { /* ... */ }
        .feedback-area { /* ... */ } #personality-match-section { /* ... */ }
        #personality-match-section h2 { color: var(--highlight-purple-lighter); /* ... */ }
        #personality-match-section p { color: #E0D8F0; }
        @media (max-width: 768px) {
            .site-navbar { width: 100%; height: auto; max-height: 50vh; position: static; 
                           border-right: none; border-bottom: 1px solid #CCCCCC;
                           padding: 1.5rem 1rem; min-width: unset; max-width: unset; }
            #navbar-agraj-image { width: 50%; max-width: 150px; margin-bottom: 0.5rem;}
            .site-navbar #typewriter, .site-navbar .quote { font-size: 0.8rem; margin-bottom: 0.5rem; margin-top: 0.5rem; }
            .navbar-links a { padding: 0.6rem 1rem; font-size: 1rem; }
            #navbar-logo-image { width: 45px; margin-top: 1rem; }
            .site-content { margin-left: 0; width: 100%; padding: 1.5rem 1rem; }
            #animated-images-container-wrapper { height: 60vh; }
            .progress-container { display: none; } 
        }
    </style>
</head>
<body>
    <!-- Audio elements, p5 canvas, progress bar, overlay -->
    <audio id="gameSpawnSound" src="spawn_sound.mp3" preload="auto"></audio>
    <audio id="gameWinSound" src="win_sound.mp3" preload="auto"></audio>
    <audio id="revealSound" src="reveal_sound.mp3" preload="auto"></audio>
    <div id="p5-background-canvas"></div>
    <div class="progress-container"> <div class="progress-bar" id="progressBar"></div> </div> 
    <div class="bg-overlay"></div>

    <div class="site-container">
        <aside class="site-navbar">
            <!-- Navbar content from previous response -->
        </aside>
        <main class="site-content">
            <div id="page-container">
                <!-- Page sections from previous response -->
            </div>
        </main>
    </div>
    <div id="secret-game-modal">
        <!-- Secret game modal content from previous response -->
    </div>

    <script>
        const APP_CONFIG = {
             ROTATING_TEXT_HOME: { 
                 'typewriter': { texts: ["Cause no one listens, so I write instead 😎"], typeSpeed: 80, deleteSpeed: 50, pauseDuration: 3000 },
                 'main-heading-text': { texts: ["agraj", "アグラジ", "अग्रज", "αγραξ"], typeSpeed: 100, deleteSpeed: 60, pauseDuration: 2500 }, 
                 'blockquote-text': { 
                     texts: [
                        "The stream ran bright, water paving away, tap dancing with sunlight.",
                        "Was I born different? What did I do different that made me the way I am?",
                        "Time flies by; for me it does so in gloom. Worries of the future, regrets of the past.",
                        "If a book doesn't change you, even in the slightest, it isn't worth reading.",
                        "All went away for nothing, and all I am now is who I was never supposed to be."
                     ], 
                     typeSpeed: 70, deleteSpeed: 40, pauseDuration: 4500 
                 }
            },
            DEFAULT_TITLES: { home: "agraj - Portfolio", writings: "Writings - Agraj Dubey", about: "About Me - Agraj Dubey" },
            POSTS_JSON_PATH: 'posts.json', QUESTIONS_JSON_PATH: 'questions.json',
            TELEGRAM_USERNAME: 'agraj0669', MATCH_THRESHOLD_FOR_CONTACT: 70
        };
        
        let ALL_QUESTIONNAIRE_DATA = []; let visitorAnswers = {}; let questionsAnsweredCount = 0;
        let revealSound, gameSpawnSoundEl, gameWinSoundEl;

        function $(selector) { return document.querySelector(selector); }
        function $$(selector) { return document.querySelectorAll(selector); }

        let p5Blobs = []; const NUM_P5_BLOBS = 5; 
        function p5Sketch(p) { /* ... p5.js code from previous (no changes needed here for this fix) ... */ }
        
        let ALL_POST_DATA_FOR_HOME_RECENT = []; let ALL_POSTS_DATA = [];
        function simpleMarkdownToHtml(md) { /* ... code ... */ }
        function createPostPreviewCard(post, isForHome = false) { /* ... code ... */ }
        function createFullArticleHtml(post) { /* ... code ... */ }
        async function setupHomePageRightColumnImages() { /* ... code ... */ }
        async function loadAndRenderPosts() { /* ... code ... */ }
        
        async function renderQuestionnaire() { /* ... code ... */ }
        function setupQuestionnaireInteractions() { /* ... code ... */ }
        function calculateAndShowMatch() { /* ... code ... */ }

        let matterEngine, matterRender, matterRunner; /* ... Secret Game JS ... */
        function playSound(soundElement) { /* ... code ... */ }
        function resetSecretGame() { /* ... code ... */ }
        function updateGameInfoDisplay() { /* ... code ... */ }
        function setupSecretGame() { /* ... code ... */ }
        
        let rotatingTextInstances = {};
        function setupRotatingText(elementId, config) { 
            if (rotatingTextInstances[elementId]) { return; }
            const element = document.getElementById(elementId);
            if (!element) { console.warn(`Rotating text element not found: #${elementId}`); return; }
            
            let currentIndex = -1, isBusy = false, cycleTimeout = null;
            // For typewriter, main-heading, blockquote which are in navbar, 'isVisible' is effectively always true after load.
            // 'runOnce' is still respected.
            let isVisible = true; // Assume true for elements this function is called on in this new design
            const runOnce = (elementId === 'typewriter' || config.texts.length === 1); 
            
            element.textContent = ''; 

            function typeWriterInternal(text, callback) {
                let i = 0; isBusy = true;
                function type() {
                    if (!isBusy) { // Simplified: if not busy, stop. No explicit isVisible check here as it's assumed true.
                        isBusy = false; 
                        if (!isVisible && elementId !== 'typewriter' && elementId !== 'blockquote-text' && elementId !== 'main-heading-text') element.textContent = ''; // Only clear if it was an observed element
                        return; 
                    }
                    if (i < text.length) {
                        element.textContent += text.charAt(i); i++;
                        setTimeout(type, config.typeSpeed);
                    } else {
                        const existingCursor = element.querySelector('.typed-cursor');
                        if (existingCursor) existingCursor.remove();
                        const cursor = document.createElement('span'); cursor.className = 'typed-cursor'; element.appendChild(cursor);
                        isBusy = false; if (callback) callback();
                    }
                } type();
            }

            function deleteWriterInternal(callback) {
                if (runOnce && element.textContent.length > 0) { 
                    // If runOnce and text is already there, ensure cursor is present and call callback.
                    const existingCursor = element.querySelector('.typed-cursor');
                    if (!existingCursor) {
                        const cursor = document.createElement('span'); cursor.className = 'typed-cursor'; element.appendChild(cursor);
                    }
                    if (callback) callback(); return; 
                }
                let text = element.textContent;
                const existingCursor = element.querySelector('.typed-cursor');
                if (existingCursor) existingCursor.remove();
                text = element.textContent; 
                let i = text.length; isBusy = true;
                function del() {
                     if (!isBusy) { // Simplified
                        isBusy = false; 
                        if (!isVisible && elementId !== 'typewriter' && elementId !== 'blockquote-text' && elementId !== 'main-heading-text') element.textContent = '';
                        return; 
                    }
                    if (i > 0) {
                        element.textContent = text.substring(0, i - 1); i--;
                        if (!element.querySelector('.typed-cursor') && element.textContent.length > 0) {
                           const cursor = document.createElement('span'); cursor.className = 'typed-cursor'; element.appendChild(cursor);
                        } setTimeout(del, config.deleteSpeed);
                    } else {
                        const finalCursor = element.querySelector('.typed-cursor'); if (finalCursor) finalCursor.remove();
                        element.textContent = ''; isBusy = false; if (callback) callback();
                    }
                } del();
            }
            function scheduleCycle(delay) { if (runOnce) return; clearTimeout(cycleTimeout); cycleTimeout = setTimeout(startCycle, delay); }
            
            function startCycle() {
                if (runOnce || isBusy) return; // Simplified isVisible check
                deleteWriterInternal(() => {
                    if (!isVisible && elementId !== 'typewriter' && elementId !== 'blockquote-text' && elementId !== 'main-heading-text') return; // Only applies if it was an observed element
                    let nextIndex;
                    do { nextIndex = Math.floor(Math.random() * config.texts.length); }
                    while (nextIndex === currentIndex && config.texts.length > 1);
                    currentIndex = nextIndex; const nextText = config.texts[currentIndex];
                    element.textContent = ''; typeWriterInternal(nextText, () => scheduleCycle(config.pauseDuration));
                });
            }
            
            // For navbar elements, directly initialize
            const alwaysVisibleNavbarElements = ['typewriter', 'blockquote-text', 'main-heading-text'];
            if (alwaysVisibleNavbarElements.includes(elementId)) {
                currentIndex = runOnce ? 0 : (elementId === 'main-heading-text' ? 0 : Math.floor(Math.random() * config.texts.length));
                const firstText = config.texts[currentIndex];
                element.textContent = ''; // Clear any static text from HTML
                typeWriterInternal(firstText, () => { if (!runOnce) scheduleCycle(config.pauseDuration); });
            } else {
                // Fallback to original IntersectionObserver for any other elements if used elsewhere (currently not)
                let initialized = false;
                const intersectionObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        const wasVisible = isVisible; isVisible = entry.isIntersecting;
                        if (isVisible && !wasVisible) {
                            if (!initialized) {
                                initialized = true;
                                currentIndex = runOnce ? 0 : Math.floor(Math.random() * config.texts.length);
                                const firstText = config.texts[currentIndex];
                                element.textContent = ''; typeWriterInternal(firstText, () => { if (!runOnce) scheduleCycle(config.pauseDuration); });
                            } else { 
                                if (!isBusy) {
                                    if (runOnce) { if(element.textContent === '') { element.textContent = ''; typeWriterInternal(config.texts[0], () => {}); }}
                                    else { element.textContent = ''; scheduleCycle(100); }
                                }
                            }
                        } else if (!isVisible && wasVisible) { clearTimeout(cycleTimeout); isBusy = false; }
                    });
                }, { threshold: 0.1 });
                intersectionObserver.observe(element);
                rotatingTextInstances[elementId] = { observer: intersectionObserver, element: element };
            }
        }
        
        function setupScrollProgressBar() { /* ... code ... */ }
        function setupWritingsCardHoverEffects() { /* ... code ... */ }
        
        let currentMainSection = null; let lastClickedReadMoreLink = null; 
        function showMainSection(sectionId) { 
            const previouslyActiveSection = $('.page-section.active-section');
            if (previouslyActiveSection) {
                previouslyActiveSection.classList.remove('active-section');
                previouslyActiveSection.style.display = 'none'; // Explicitly hide
            }
            
            const targetSection = $(`#${sectionId}`);
            if (targetSection) {
                targetSection.style.display = 'block'; // Explicitly show before adding class for animation
                targetSection.classList.add('active-section');
                currentMainSection = sectionId;

                $$('.site-navbar .navbar-links a').forEach(navLink => {
                    navLink.classList.remove('active');
                    const navTarget = navLink.dataset.navlink;
                    if ( (sectionId === 'home-content' && navTarget === 'home') ||
                         (sectionId === 'writings-content' && navTarget === 'writings') ||
                         (sectionId === 'about-content' && navTarget === 'about') ) {
                        navLink.classList.add('active');
                    }
                });
                
                if (sectionId === 'about-content' && typeof renderQuestionnaire === 'function') {
                    renderQuestionnaire(); 
                } else if (sectionId === 'home-content' && typeof setupHomePageRightColumnImages === 'function') {
                    // Ensure bubbles are set up if not already
                     const existingBubbles = $$('#animated-images-container .animated-post-image-bubble');
                    if (existingBubbles.length === 0 && ALL_POSTS_DATA.length > 0) { // Only if no bubbles and data is loaded
                        setupHomePageRightColumnImages();
                    }
                }
                window.scrollTo({ top: 0, behavior: 'auto' });
            } else { console.warn(`Target section #${sectionId} not found.`); }
        }

        function handleMainRouteChange() { 
            let mainSectionTarget = 'home-content'; 
            let articleDetailHash = '';
            const currentFullHash = window.location.hash;

            if (currentFullHash.startsWith('#post-')) {
                mainSectionTarget = 'writings-content'; articleDetailHash = currentFullHash;
            } else if (currentFullHash === '#writings') {
                mainSectionTarget = 'writings-content';
            } else if (currentFullHash === '#about') {
                mainSectionTarget = 'about-content';
            } else if (currentFullHash === '#home' || currentFullHash === '' || currentFullHash === '#') {
                mainSectionTarget = 'home-content'; 
                if (currentFullHash === '' || currentFullHash === '#') {
                    if (window.history.replaceState) {
                        window.history.replaceState(null, '', '#home'); // Update URL without new history entry
                    } else {
                        window.location.hash = '#home'; // Fallback
                    }
                    // No return here, proceed to show home if it's the initial load.
                }
            } else { 
                const isExternalNav = Array.from($$('.site-navbar .navbar-links a[target="_blank"]'))
                                        .some(link => link.href.endsWith(currentFullHash) || `#${link.dataset.navlink}` === currentFullHash);
                if (!isExternalNav) {
                     console.warn("Unknown hash, redirecting to #home:", currentFullHash);
                     if (window.history.replaceState) { window.history.replaceState(null, '', '#home'); } 
                     else { window.location.hash = '#home'; }
                     mainSectionTarget = 'home-content'; // Ensure we process #home now
                } else {
                    return; // It's an external link click, do nothing with page sections
                }
            }
            
            // If the target section is not currently active, show it.
            if (currentMainSection !== mainSectionTarget) {
                 showMainSection(mainSectionTarget);
            }

            // Handle article display within writings section
            if (mainSectionTarget === 'writings-content') {
                if(typeof handleWritingsArticleLogic === 'function') {
                    handleWritingsArticleLogic(articleDetailHash); // Will show specific post or grid
                }
                document.title = articleDetailHash ? ($(`#${articleDetailHash.substring(1)} h2`)?.textContent + " - Writings") : APP_CONFIG.DEFAULT_TITLES.writings;

            } else if (mainSectionTarget === 'about-content') {
                document.title = APP_CONFIG.DEFAULT_TITLES.about;
            } else if (mainSectionTarget === 'home-content') { 
                document.title = APP_CONFIG.DEFAULT_TITLES.home; 
            }
        }

        function handleWritingsArticleLogic(articleHash) { /* ... (same as before) ... */ }
        function isElementInViewport(el) { /* ... (same as before) ... */ }
        
        document.addEventListener('DOMContentLoaded', async () => {
            // ... (sound elements initialization) ...
            revealSound = $('#revealSound'); gameSpawnSoundEl = $('#gameSpawnSound'); gameWinSoundEl = $('#gameWinSound');
            if (typeof p5 !== 'undefined') { new p5(p5Sketch); } else { console.error("p5.js is not loaded!"); }
            
            setupScrollProgressBar();
            await loadAndRenderPosts(); // Load posts first, this populates ALL_POSTS_DATA
            
            // Initialize typewriter for navbar elements as they are always visible
            for (const elId in APP_CONFIG.ROTATING_TEXT_HOME) {
                if (document.getElementById(elId) && typeof setupRotatingText === 'function') { 
                     setupRotatingText(elId, APP_CONFIG.ROTATING_TEXT_HOME[elId]);
                }
            }
            
            // ... (click listener for lastClickedReadMoreLink) ...
            document.body.addEventListener('click', function(event) { /* ... */ });

            handleMainRouteChange(); // Initial route handling
            window.addEventListener('hashchange', handleMainRouteChange); 
            
            setupSecretGame(); 
            window.addEventListener('resize', () => { /* ... */ });
        });
    </script>
</body>
</html>
