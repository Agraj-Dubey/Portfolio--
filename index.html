<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>agraj - Portfolio</title>
    <link rel="icon" type="image/png" href="frieren.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+Bhai+2:wght@700&family=Inter:wght@400;500;600;700&family=Lato:ital,wght@0,400;0,700;1,400&family=Outfit:wght@400;500;700&family=Nunito:wght@400;700&family=Fuzzy+Bubbles:wght@400;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>

    <script>
        window.tailwind.config = { /* ... Tailwind config remains the same ... */ };
        // Paste the Tailwind config from the previous response here to keep it concise
        window.tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark': '#0f0a19', 'darker': '#090613', 'accent': '#9272CE',
                        'accent-hover': '#AE8BD5', 'light-accent': '#CBB8E8',
                        'text-primary': '#ffffff', 'text-secondary': '#D1D1D1', 'text-tertiary': '#A8A8A8',
                        'article-bg': 'rgba(20, 20, 22, 0.93)', 'writings-card-bg': 'rgba(25, 15, 40, 0.9)', // Slightly more opaque
                        'writings-card-hover-bg': 'rgba(45, 35, 60, 0.97)', 'dark-purple-bg': '#1a0a2e',
                        'hover-highlight': 'rgba(146, 114, 206, 0.1)', 'brand-purple': '#9272CE',
                        'brand-hover': '#AE8BD5', 'brand-light-purple': '#CBB8E8',
                        'brand-dark': '#050505', 'brand-light': '#FFFFFF', 'brand-gray': '#D1D1D1',
                        'brand-text': '#A8A8A8',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'], serif: ['Baloo Bhai 2', 'cursive'],
                        lato: ['Lato', 'sans-serif'], outfit: ['Outfit', 'sans-serif'],
                        nunito: ['Nunito', 'sans-serif'], 'fuzzy-bubbles': ['Fuzzy Bubbles', 'cursive'],
                        verdana: ['Verdana', 'sans-serif'], 'trebuchet': ['Trebuchet MS', 'sans-serif'],
                    },
                }
            }
        };
    </script>

    <style>
        html { scroll-behavior: smooth; }
        body {
            background-color: #0f0a19; color: #D1D1D1; font-family: 'Inter', sans-serif;
            overflow-x: hidden; line-height: 1.6; font-size: 16px;
        }
        #hyperspeed-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -10; background-color: #07040e; /* Even darker for better contrast */ }
        .bg-overlay { /* ... remains the same ... */ }

        .page-section { /* ... remains the same ... */ }
        h1,h2,h3,h4,h5,h6 { /* ... remains the same ... */ }
        .font-serif, .font-outfit, .gradient-text, @keyframes gradientTextAnim, .typed-cursor, #home-content h1 .typed-cursor, #home-content blockquote .typed-cursor, #typewriter .typed-cursor, #main-heading-text .typed-cursor, #blockquote-text .typed-cursor, @keyframes pulseCursor, #typewriter, #main-heading-text, #blockquote-text, ::-webkit-scrollbar, ::-webkit-scrollbar-track, ::-webkit-scrollbar-thumb, ::-webkit-scrollbar-thumb:hover { /* ... remain the same ... */ }
        
        .main-header, .main-header .nav-logo, .desktop-nav a, .desktop-nav a::after, .desktop-nav a:hover::after, .desktop-nav a:hover, .desktop-nav a.active, .desktop-nav a.active::after, .nav-toggle-btn, .nav-toggle-btn svg, .nav-toggle-btn:hover svg, .mobile-menu, .mobile-menu.is-open, .mobile-menu a, .mobile-menu a:hover, .mobile-menu a.active, @keyframes slideDownFade, .desktop-nav a[target="_blank"]::after, .mobile-menu a[target="_blank"]::after { /* ... Header styles remain the same ... */ }
        /* Paste the full CSS from the previous response here, then apply modifications below */
        .bg-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 50% 30%, rgba(146, 114, 206, 0.03), rgba(15, 10, 25, 0.85) 70%); z-index: -5; pointer-events: none; }
        .page-section { display: none; animation: fadeInPage 0.7s ease-out forwards; }
        .page-section.active-section { display: block; }
        @keyframes fadeInPage { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        h1, h2, h3, h4, h5, h6 { color: #ffffff; font-weight: 700; }
        .font-serif { font-family: 'Baloo Bhai 2', cursive; }
        .font-outfit { font-family: 'Outfit', sans-serif; }
        .gradient-text { background: linear-gradient(90deg, #FFFFFF, #CBB8E8, #9272CE, #CBB8E8, #FFFFFF); background-size: 300% auto; background-clip: text; -webkit-background-clip: text; color: transparent; animation: gradientTextAnim 8s linear infinite; display: inline-block; }
        @keyframes gradientTextAnim { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .typed-cursor { display: inline-block; width: 2px; background-color: #9272CE; margin-left: 4px; animation: pulseCursor 1s infinite; vertical-align: text-bottom; }
        #home-content h1 .typed-cursor { height: 1em; background-color: #CBB8E8; }
        #home-content blockquote .typed-cursor { background-color: #A8A8A8; }
        #typewriter .typed-cursor { background-color: #D1D1D1; height: 1.1em;}
        #main-heading-text .typed-cursor { height: 1.1em; }
        #blockquote-text .typed-cursor { height: 1.1em; }
        @keyframes pulseCursor { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        #typewriter { min-height: 3em; display: inline-block; width: 100%; }
        #main-heading-text { min-height: 1.2em; display: inline-block; }
        #blockquote-text { min-height: 4em; display: inline-block; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(9, 6, 19, 0.8); }
        ::-webkit-scrollbar-thumb { background: rgba(146, 114, 206, 0.5); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(146, 114, 206, 0.7); }
        .main-header { position: sticky; top: 0; left: 0; width: 100%; background-color: rgba(9, 6, 19, 0.85); backdrop-filter: blur(10px); z-index: 50; border-bottom: 1px solid rgba(146, 114, 206, 0.1); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .main-header .nav-logo { font-family: 'Baloo Bhai 2', cursive; transition: color 0.3s ease; }
        .main-header .nav-logo:hover { color: #9272CE; }
        .desktop-nav a { position: relative; display: inline-block; transition: color 0.3s ease; }
        .desktop-nav a::after { content: ''; position: absolute; bottom: -3px; left: 0; width: 0; height: 1.5px; background-color: #9272CE; transition: width 0.3s ease; }
        .desktop-nav a:hover::after { width: 100%; }
        .desktop-nav a:hover, .desktop-nav a.active { color: #9272CE; }
        .desktop-nav a.active::after { width: 100%; }
        .nav-toggle-btn { background: none; border: none; padding: 0.5rem; cursor: pointer; z-index: 60; }
        .nav-toggle-btn svg { stroke: #ffffff; transition: stroke 0.3s ease; }
        .nav-toggle-btn:hover svg { stroke: #9272CE; }
        .mobile-menu { display: none; position: absolute; top: 100%; left: 0; width: 100%; background-color: rgba(9, 6, 19, 0.95); backdrop-filter: blur(8px); padding: 1rem 0; box-shadow: 0 10px 20px rgba(0,0,0,0.4); z-index: 55; animation: slideDownFade 0.4s ease-out forwards; }
        .mobile-menu.is-open { display: block; }
        .mobile-menu a { display: block; padding: 0.8rem 1.5rem; font-size: 1.1rem; transition: color 0.3s ease, background-color 0.3s ease; text-align: center; }
        .mobile-menu a:hover { color: #9272CE; background-color: rgba(146, 114, 206, 0.1); }
        .mobile-menu a.active { background-color: rgba(146, 114, 206, 0.1); font-weight: 600; color: #9272CE; }
        @keyframes slideDownFade { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .desktop-nav a[target="_blank"]::after, .mobile-menu a[target="_blank"]::after { content: ' \2197'; font-size: 0.7em; vertical-align: super; display: inline-block; margin-left: 2px; opacity: 0.7; width: auto !important; height: auto !important; background: none !important; }


        /* --- Home Section Styles --- */
        #heroSection {
            position: relative; /* For positioning children */
            display: flex; /* To layout text and image side-by-side on larger screens */
            align-items: center;
            min-height: 70vh; /* Ensure it has some height */
        }

        #home-hero-text-content {
            flex-grow: 1; /* Takes up available space */
            position: relative; /* For z-index if needed */
            z-index: 10;
            padding-right: 2rem; /* Space from image on large screens */
        }
        
        #home-hero-image-container {
            position: absolute; /* Changed from absolute to relative for flex context */
            top: 0; right: 0; bottom: 0;
            width: 35%; /* Adjust width as desired */
            max-width: 450px; /* Max width for the image panel */
            height: 100%; 
            display: none; /* Hidden on small screens */
            align-items: center; /* Vertically center image if container is taller */
            justify-content: center; /* Horizontally center image */
            opacity: 0; /* Initial state for animation */
            transition: opacity 1.2s ease-in-out 0.5s; /* Fade in after text */
            z-index: 5;
             -webkit-mask-image: linear-gradient(to right, transparent 0%, black 25%); /* Feather left edge */
             mask-image: linear-gradient(to right, transparent 0%, black 25%);
        }
        
        #home-hero-profile-image {
            width: 100%; height: 100%;
            object-fit: cover;
            object-position: center; 
            filter: grayscale(30%) brightness(0.85); /* Slightly desaturated and dimmed */
        }

        @media (min-width: 1024px) { /* lg breakpoint */
            #home-hero-image-container {
                display: flex; /* Show on large screens */
                position: relative; /* Back to relative for flex item */
                flex-shrink: 0; /* Don't shrink */
                width: 30%; /* Example width for lg screens */
            }
            #home-hero-text-content {
                width: 70%; /* Remaining width */
                 padding-right: 3rem;
            }
        }
        @media (min-width: 1280px) { /* xl breakpoint */
             #home-hero-image-container { width: 35%; }
             #home-hero-text-content { width: 65%; }
        }


        #home-content .quote { /* ... remains the same ... */ }
        #home-content .card { /* ... remains the same ... */ }
        #home-content .card::before { /* ... remains the same ... */ }
        #home-content .card:hover { /* ... remains the same ... */ }
        #home-content .card:hover::before { /* ... remains the same ... */ }
        #home-content .hover-link { /* ... remains the same ... */ }
        #home-content .hover-link::after { /* ... remains the same ... */ }
        #home-content .hover-link:hover::after { /* ... remains the same ... */ }
        .static-image-container { /* ... remains the same ... */ }
        .static-image { /* ... remains the same ... */ }
        .static-image:hover { /* ... remains the same ... */ }

        /* --- Writings Section Styles --- */
        #writings-content { /* ... remains the same ... */ }
        #writings-content .text-hover-scale { /* ... remains the same ... */ }
        .writing-preview-card { /* ... remains the same, including increased padding and font sizes */ }
        .writing-preview-card:hover { /* ... remains the same ... */ }
        @keyframes cardGlowWritings { /* ... remains the same ... */ }
        .writing-preview-card h3 { /* ... remains the same ... */ }
        .writing-preview-card .post-meta-info { /* ... remains the same ... */ }
        .writing-preview-card .excerpt { /* ... remains the same ... */ }
        .writing-preview-card a.read-more-link { /* ... remains the same ... */ }
        .writing-preview-card a.read-more-link:hover { /* ... remains the same ... */ }

        #full-articles-container { /* ... remains the same ... */ }
        #full-articles-container article { /* ... remains the same ... */ }
        #full-articles-container article:target { /* ... remains the same ... */ }
        @keyframes fadeInArticle { /* ... remains the same ... */ }
        #writings-grid-container:has(~ #full-articles-container article:target) { /* ... remains the same ... */ }
        hr.separator:has(~ #full-articles-container article:target) { /* ... remains the same ... */ }
        #full-articles-container h2 { /* ... remains the same ... */ }
        #full-articles-container .post-meta-info { /* ... remains the same ... */ }
        a.back-button { /* ... remains the same ... */ }
        a.back-button:hover { /* ... remains the same ... */ }
        hr.separator { /* ... remains the same ... */ }
        
        .post-content-html {
            white-space: pre-line; /* Respect newlines from source, wrap lines */
        }
        .post-content-html p, .post-content-html blockquote, .post-content-html span, .post-content-html div, .post-content-html b, .post-content-html strong, .post-content-html i, .post-content-html em, .post-content-html u, .post-content-html a { 
            font-family: inherit; font-size: 1.1rem; line-height: 1.85; color: #D1D1D1; 
            background-color: transparent !important; 
            text-align: left !important; /* Force left alignment for all content within */
            margin: 0 0 1.5em 0; font-weight: normal; font-style: normal; 
            text-decoration: none; word-wrap: break-word; border-radius: 3px; 
        }
        .post-content-html > p:first-child { margin-top: 0; } /* Prevent double margin if content starts with p */
        .post-content-html > div:first-child { margin-top: 0; }

        .post-content-html span { margin: 0; display: inline; }
        /* Style overrides from JSON content */
        .post-content-html [style*="font-family: Outfit"] { font-family: 'Outfit', sans-serif; } 
        .post-content-html [style*="font-family: Nunito"] { font-family: 'Nunito', sans-serif; } 
        .post-content-html [style*="font-family: Fuzzy Bubbles"] { font-family: 'Fuzzy Bubbles', cursive; } 
        .post-content-html [style*="font-family: verdana"] { font-family: 'Verdana', sans-serif; } 
        .post-content-html [style*="font-family: trebuchet"] { font-family: 'Trebuchet MS', sans-serif; }
        .post-content-html b, .post-content-html strong, .post-content-html [style*="font-weight: bold"] { font-weight: 700; } 
        .post-content-html i, .post-content-html em, .post-content-html [style*="font-style: italic"] { font-style: italic; } 
        .post-content-html u { text-decoration: underline; } 
        .post-content-html a { color: #9272CE; text-decoration: underline; transition: color 0.2s ease; display: inline; } 
        .post-content-html a:hover { color: #AE8BD5; }
        /* Explicit text-align overrides from JSON still respected if absolutely needed, but base is left */
        .post-content-html p[style*="text-align: center;"], .post-content-html div[style*="text-align: center;"], .post-content-html blockquote[style*="text-align: center;"] { 
            text-align: center !important; margin-left: auto; margin-right: auto; 
        }
        .post-content-html blockquote { border-left: 4px solid #9272CE; padding: 1em 1.75rem; margin-left: 0; margin-right: 0; font-style: italic; color: #A8A8A8; background-color: rgba(146, 114, 206, 0.05); }
        .post-content-html blockquote blockquote { margin-top: 1em; margin-left: 1.5rem; border-left-color: #AE8BD5; padding-left: 1rem; background-color: rgba(174, 139, 213, 0.05); }
        .post-content-html blockquote p { margin-bottom: 0.75em; }
        .post-content-html img { /* ... remains the same ... */ }
        .post-content-html img:hover { /* ... remains the same ... */ }
        .post-content-html .separator { /* ... remains the same ... */ }
        @layer utilities { /* ... remains the same ... */ }

        .glitch-button { /* ... remains the same ... */ }
        .glitch-button .btn-text { /* ... remains the same ... */ }
        .glitch-button::before, .glitch-button::after { /* ... remains the same ... */ }
        .glitch-button:hover::before { /* ... remains the same ... */ }
        .glitch-button:hover::after { /* ... remains the same ... */ }
        .glitch-button:active { /* ... remains the same ... */ }
        @keyframes glitchEffectBefore { /* ... remains the same ... */ }
        @keyframes glitchEffectAfter { /* ... remains the same ... */ }
        #home-content .view-all-writings-btn { /* ... remains the same ... */ }
        #home-content .view-all-writings-btn:hover { /* ... remains the same ... */ }

        .main-footer { /* ... remains the same ... */ }
        #secret-game-trigger { /* ... remains the same ... */ }
        #secret-game-trigger:hover { /* ... remains the same ... */ }
        #secret-game-modal { /* ... remains the same ... */ }
        @keyframes fadeInGameModal { /* ... remains the same ... */ }
        #matter-canvas { /* ... remains the same ... */ }
        #close-game-button { /* ... remains the same ... */ }
        #close-game-button:hover { /* ... remains the same ... */ }
        .progress-container { /* ... remains the same ... */ }
        .progress-bar { /* ... remains the same ... */ }

    </style>
</head>
<body>
    <canvas id="hyperspeed-canvas"></canvas>
    <!-- ... rest of body structure (progress bar, bg-overlay, header) remains the same ... -->
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>
    <div class="bg-overlay"></div>

    <header class="main-header">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <a href="#home" class="nav-logo text-2xl lg:text-3xl font-bold text-text-primary">a-g-r-a-j</a>
                <button id="nav-toggle" class="nav-toggle-btn md:hidden" aria-label="Toggle Menu" aria-expanded="false">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
                </button>
                <nav class="desktop-nav hidden md:flex space-x-8 text-text-primary items-center">
                    <a href="https://www.blogger.com/profile/06675668817383737660" target="_blank" rel="noopener noreferrer">About Me</a>
                    <a href="https://www.reddit.com/user/Federal_Anywhere_559/" target="_blank" rel="noopener noreferrer">Contact Me</a>
                    <a href="#writings" data-navlink="writings">Writings</a>
                    <a href="#home" data-navlink="home" class="active">Home</a>
                </nav>
            </div>
            <nav id="mobile-menu" class="mobile-menu md:hidden">
                <a href="https://www.blogger.com/profile/06675668817383737660" target="_blank" rel="noopener noreferrer">About Me</a>
                <a href="https://www.reddit.com/user/Federal_Anywhere_559/" target="_blank" rel="noopener noreferrer">Contact Me</a>
                <a href="#writings" data-navlink="writings">Writings</a>
                <a href="#home" data-navlink="home" class="active">Home</a>
            </nav>
        </div>
    </header>


    <div id="page-container">
        <section id="home-content" class="page-section">
            <main class="container mx-auto px-6 pt-20 md:pt-24 pb-16"> {/* Adjusted top padding */}
                <section class="text-center md:text-left mb-16 md:mb-20 opacity-0 min-h-[60vh] md:min-h-[70vh]" id="heroSection"> {/* min-height added */}
                    <div id="home-hero-text-content" class="py-8 md:py-12"> {/* Padding for text content */}
                        <h1 class="gradient-text text-5xl md:text-6xl lg:text-7xl font-bold mb-6 tracking-tight font-serif relative z-10">
                            <span id="main-heading-text"></span>
                        </h1>
                        <p class="text-xl md:text-2xl text-text-secondary mb-10 md:mb-12 italic relative z-10" id="typewriter"></p>
                        <blockquote class="quote max-w-xl md:max-w-2xl mx-auto md:mx-0 text-lg md:text-xl bg-darker/80 backdrop-blur-sm p-6 rounded-lg shadow-xl text-text-tertiary border-l-4 border-accent relative z-10">
                            "<span id="blockquote-text"></span>"
                        </blockquote>
                    </div>
                    <div id="home-hero-image-container">
                        <img src="agraj_profile.jpg" alt="Agraj Dubey" id="home-hero-profile-image">
                    </div>
                </section>

                <!-- ... rest of home-content (Recent Writings, Static Image) remains the same ... -->
                <section class="mb-16 opacity-0 relative z-10" id="writingsSectionHome">
                    <h2 class="text-3xl md:text-4xl font-bold text-center text-text-primary mb-12">Recent Writings</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="home-recent-writings-grid">
                        <!-- Recent writings will be populated here by JS -->
                    </div>
                    <div class="text-center mt-12 md:mt-16">
                        <a href="#writings" class="view-all-writings-btn glitch-button" data-text="View All Writings">
                            <span class="btn-text">View All Writings</span>
                        </a>
                    </div>
                    <div id="staticImageContainerHome" class="static-image-container">
                        <img src="FrierenRing.png" alt="Ring Image" id="staticImageHome" class="static-image">
                    </div>
                </section>
            </main>
        </section>

        <!-- ... Writings Section and Footer remain structurally the same ... -->
        <section id="writings-content" class="page-section">
            <main class="container mx-auto px-6 py-16 md:py-20 min-h-screen">
                <div class="text-center mb-12 md:mb-16 pt-8">
                     <h1 class="text-4xl md:text-5xl font-bold text-text-primary font-outfit">My Writings</h1>
                </div>
                <section id="writings-grid-container" class="mb-12 md:mb-20 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                     <!-- All writings previews will be populated here by JS -->
                </section>
                <hr class="separator">
                <section id="full-articles-container">
                    <div class="full-articles-content max-w-4xl mx-auto" id="full-articles-dynamic-content">
                        <!-- Full articles will be populated here by JS when targeted -->
                    </div>
                </section>
            </main>
        </section>
    </div>

    <footer class="main-footer relative z-10">
        <div class="container mx-auto px-6">
            <p class="text-text-tertiary">¬© <span id="currentYear"></span> agraj. All rights reserved.
                <span id="secret-game-trigger" title="?">üïπÔ∏è</span>
            </p>
        </div>
    </footer>

    <div id="secret-game-modal">
        <canvas id="matter-canvas"></canvas>
        <button id="close-game-button" class="glitch-button" data-text="Close Game"><span class="btn-text">Close Game</span></button>
    </div>


    <script>
        const APP_CONFIG = { /* ... APP_CONFIG from previous response ... */ };
        APP_CONFIG.ROTATING_TEXT_HOME = { /* ... from previous ... */ };
        APP_CONFIG.DEFAULT_TITLES = { /* ... from previous ... */ };
        APP_CONFIG.POSTS_JSON_PATH = 'posts.json';
        // Paste the full APP_CONFIG from the previous response here
         APP_CONFIG.ROTATING_TEXT_HOME = {
             'typewriter': { texts: ["Cause no one listens, so I write instead üòé"], typeSpeed: 80, deleteSpeed: 50, pauseDuration: 3000 },
             'main-heading-text': { texts: ["agraj", "„Ç¢„Ç∞„É©„Ç∏", "‡§Ö‡§ó‡•ç‡§∞‡§ú", "Œ±Œ≥œÅŒ±Œæ"], typeSpeed: 100, deleteSpeed: 60, pauseDuration: 2500 },
             'blockquote-text': { texts: ["If determinism holds, there's a chance I exit early‚Äîsomething dramatic. So I leave fragments of myself here‚Äîat least the algorithm remembers me better than my family willüòí", "Is free will an illusion, or is the illusion the only free will we have?", "Perhaps the 'fragments' are the only coherent parts left.", "What if the algorithm forgets too?", "Maybe exiting early isn't dramatic, just... efficient.", "Family remembers differently. Algorithms remember precisely. Which is better?", "The universe is indifferent, but the code persists. For now.", "Do androids dream of electric sheep? Do algorithms dream of better data?", "To be, or not to be, that is the computation.", "Cogito, ergo sum... I think, therefore I am... coded?"], typeSpeed: 70, deleteSpeed: 40, pauseDuration: 4500 }
        };
        APP_CONFIG.DEFAULT_TITLES = {
            home: "agraj - Portfolio",
            writings: "Writings - Agraj Dubey"
        };


        function $(selector) { return document.querySelector(selector); }
        function $$(selector) { return document.querySelectorAll(selector); }

        let matterEngine = null, matterRender = null;
        let rotatingTextInstances = {};
        let ALL_POSTS_DATA = [];

        // --- Hyperspeed Background Animation (UPDATED) ---
        const hyperspeedCanvas = $('#hyperspeed-canvas');
        const hsCtx = hyperspeedCanvas.getContext('2d');
        let stars = [];
        const numStars = 400; // Slightly fewer for performance if needed
        let mouseX = window.innerWidth / 2;
        let mouseY = window.innerHeight / 2;
        let baseSpeed = 0.008; // SLOWED DOWN base speed factor
        const aceFlagColors = ['#000000', '#A3A3A3', '#FFFFFF', '#800080']; // Black, Grey, White, Purple

        function resizeHyperspeedCanvas() { /* ... remains the same ... */ }
        // Paste resizeHyperspeedCanvas from previous
        function resizeHyperspeedCanvas() {
            hyperspeedCanvas.width = window.innerWidth;
            hyperspeedCanvas.height = window.innerHeight;
            mouseX = hyperspeedCanvas.width / 2;
            mouseY = hyperspeedCanvas.height / 2;
        }


        function initStars() {
            stars = [];
            for (let i = 0; i < numStars; i++) {
                const randomAceColor = aceFlagColors[Math.floor(Math.random() * aceFlagColors.length)];
                stars.push({
                    x: Math.random() * 2 - 1, y: Math.random() * 2 - 1, z: Math.random() * 1.8 + 0.2, // Start a bit further
                    color: randomAceColor,
                    opacity: Math.random() * 0.4 + 0.2 // Base opacity
                });
            }
        }

        function animateHyperspeed() {
            hsCtx.clearRect(0, 0, hyperspeedCanvas.width, hyperspeedCanvas.height);
            const centerX = hyperspeedCanvas.width / 2;
            const centerY = hyperspeedCanvas.height / 2;

            stars.forEach(star => {
                const screenX = centerX + (star.x / star.z) * centerX;
                const screenY = centerY + (star.y / star.z) * centerY;

                let currentSpeedFactor = 1;
                // Only speed up if mouse is close to the *projected* position of the star
                const dxMouse = screenX - mouseX;
                const dyMouse = screenY - mouseY;
                const distMouse = Math.sqrt(dxMouse * dxMouse + dyMouse * dyMouse);
                
                if (distMouse < 100) { // Hover effect radius (smaller)
                    currentSpeedFactor = 1 + (5 * (1 - distMouse / 100)); // Speed up more significantly and locally
                }

                star.z -= baseSpeed * currentSpeedFactor;

                if (star.z <= 0.005) { // Reset star if too close or behind
                    star.x = Math.random() * 2 - 1;
                    star.y = Math.random() * 2 - 1;
                    star.z = Math.random() * 1.8 + 0.2; // Reset further back
                    star.color = aceFlagColors[Math.floor(Math.random() * aceFlagColors.length)];
                    star.opacity = Math.random() * 0.4 + 0.2;
                }
                
                const size = Math.max(0.3, (1 / star.z) * 2.5); // Star size based on depth
                const dynamicOpacity = Math.min(1, (star.opacity + (1 / star.z) * 0.3)); // Fade in as they get closer

                if (screenX > -size && screenX < hyperspeedCanvas.width + size && screenY > -size && screenY < hyperspeedCanvas.height + size) {
                    hsCtx.fillStyle = star.color.startsWith('#') ? `${star.color}${Math.round(dynamicOpacity * 255).toString(16).padStart(2, '0')}` : `rgba(${star.color.slice(5,-1)}, ${dynamicOpacity})`;
                    if (star.color === '#000000' && dynamicOpacity > 0.1) { // Make black stars slightly visible if not too faint
                         hsCtx.fillStyle = `rgba(50,50,50, ${dynamicOpacity * 0.5})`; // Dark grey instead of pure black for visibility
                    }
                    hsCtx.beginPath();
                    hsCtx.arc(screenX, screenY, size, 0, Math.PI * 2);
                    hsCtx.fill();
                }
            });
            requestAnimationFrame(animateHyperspeed);
        }
        
        hyperspeedCanvas.addEventListener('mousemove', (e) => { /* ... remains the same ... */ });
        hyperspeedCanvas.addEventListener('mouseleave', () => { /* ... remains the same ... */ });
        // Paste mouse listeners from previous
        hyperspeedCanvas.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });
         hyperspeedCanvas.addEventListener('mouseleave', () => { 
            mouseX = hyperspeedCanvas.width / 2;
            mouseY = hyperspeedCanvas.height / 2;
        });


        // --- Content Rendering from JSON (UPDATED simpleMarkdownToHtml) ---
        function simpleMarkdownToHtml(md) {
            if (!md) return '';
            let html = md;
            // Remove potential surrounding backticks IF they are the very first and last characters of the string
            if (html.startsWith('`') && html.endsWith('`') && html.length > 1 && html.charAt(1) !== '`' && html.charAt(html.length-2) !== '`') {
                 html = html.substring(1, html.length - 1);
            }
            
            // Preserve explicit <br> tags by temporarily replacing them
            html = html.replace(/<br\s*\/?>/gi, '[[BR]]');
            // Convert actual newlines to <br> only if not already handled by pre-line
            // The white-space: pre-line; in CSS will handle \n, so we might not need this replacement extensively
            // However, for safety if CSS fails or for specific cases, this can stay, but could be removed if pre-line is reliable
            html = html.replace(/\n/g, '[[BR]]'); // If using pre-line, this might be redundant or cause double breaks. Test this.
                                                 // Let's try *without* this specific \n to [[BR]] conversion initially, relying on pre-line.
                                                 // If poems are single strings with \n, pre-line handles it.
                                                 // If poems are multi-line strings in JSON, JSON parser handles \n.
            
            // Let's revert: The issue is NOT double breaks but text-align. Keep \n to <br> if content is complex.
            // The contentMarkdown has \n for poems. CSS pre-line handles these.
            // If it also has explicit <br>, pre-line handles those too.
            // The crucial part is that the containing element (e.g. .post-content-html) has text-align: left and white-space: pre-line.
            // The issue might be if `simpleMarkdownToHtml` itself wraps the poem in a `<p>` and that `<p>` isn't respecting `pre-line`.
            // The current .post-content-html already has pre-line.
            
            // Minimal processing for bold/italic, let pre-line do the heavy lifting for line breaks.
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); 
            html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');    
            html = html.replace(/\\\"/g, '"');
            
            // Restore <br> tags
            // html = html.replace(/\[\[BR\]\]/g, '<br>\n'); // If we converted \n to [[BR]]

            // If we are relying on pre-line, we don't need to convert \n to <br> here at all.
            // Let's simplify: only bold/italic and quote unescaping.
            // The white-space: pre-line on .post-content-html should handle newlines from the JSON string.
            return html;
        }

        function createPostPreviewCard(post, isForHome = false) { /* ... remains the same ... */ }
        function createFullArticleHtml(post) { /* ... uses updated simpleMarkdownToHtml ... */ }
        async function loadAndRenderPosts() { /* ... remains the same ... */ }
        // Paste createPostPreviewCard, createFullArticleHtml, loadAndRenderPosts from previous
        // createPostPreviewCard
        function createPostPreviewCard(post, isForHome = false) {
            const cardClass = isForHome ? 'card' : 'writing-preview-card';
            const delay = isForHome ? (ALL_POST_DATA_FOR_HOME_RECENT.indexOf(post) * 150) : 0;

            return `
                <div class="${cardClass} rounded-lg p-7 shadow-lg relative overflow-hidden" ${isForHome ? `data-delay="${delay}"` : ''}>
                    <h3 class="text-xl lg:text-2xl font-semibold text-text-primary mb-4 group ${!isForHome ? 'text-hover-scale font-outfit' : ''}">
                        <span class="${isForHome ? 'hover:text-accent' : ''} transition-all duration-300 inline-block">${post.title}</span>
                    </h3>
                    ${!isForHome ? `<div class="post-meta-info">${new Date(post.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>` : ''}
                    <div class="mb-5"><p class="text-text-secondary line-clamp-${isForHome ? 3 : 4} ${!isForHome ? 'excerpt' : ''}">${post.excerpt}</p></div>
                    <a href="#${post.id}" class="${isForHome ? 'text-accent hover:text-accent-hover font-medium inline-flex items-center hover-link' : 'read-more-link glitch-button'}" data-text="Read More ‚Üí">
                        <span class="${!isForHome ? 'btn-text' : ''}">Read More ${!isForHome ? '‚Üí' : ''}</span>
                        ${isForHome ? '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg>' : ''}
                    </a>
                </div>
            `;
        }
        // createFullArticleHtml (uses the simplified simpleMarkdownToHtml)
        function createFullArticleHtml(post) {
            const htmlContent = simpleMarkdownToHtml(post.contentMarkdown); // Uses the simplified version now
            return `
                <article id="${post.id}" tabindex="-1">
                    <h2 class="text-hover-scale">${post.title}</h2>
                    <div class="post-meta-info">Published: ${new Date(post.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>
                    ${post.image ? `<img src="${post.image}" alt="${post.imageAlt || post.title}" class="my-8 rounded-lg shadow-lg mx-auto max-w-full md:max-w-2xl" loading="lazy">` : ''}
                    <div class="post-content-html">${htmlContent}</div>
                    <a href="#writings" class="back-button mt-8 glitch-button" data-text="‚Üê Back to Writings"><span class="btn-text">‚Üê Back to Writings</span></a>
                </article>
            `;
        }
        // loadAndRenderPosts
        let ALL_POST_DATA_FOR_HOME_RECENT = []; // For correct delay indexing
        async function loadAndRenderPosts() {
            try {
                const response = await fetch(APP_CONFIG.POSTS_JSON_PATH);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                ALL_POSTS_DATA = await response.json();
                ALL_POSTS_DATA.sort((a, b) => new Date(b.date) - new Date(a.date)); 

                ALL_POST_DATA_FOR_HOME_RECENT = ALL_POSTS_DATA.slice(0, 3); // Store for delay calculation

                const homeGrid = $('#home-recent-writings-grid');
                if (homeGrid) {
                    homeGrid.innerHTML = ALL_POST_DATA_FOR_HOME_RECENT.map(post => createPostPreviewCard(post, true)).join('');
                    setupHomeCardHoverEffects(); 
                    setupHomeScrollAnimations(); 
                }

                const writingsGrid = $('#writings-grid-container');
                if (writingsGrid) {
                    writingsGrid.innerHTML = ALL_POSTS_DATA.map(post => createPostPreviewCard(post, false)).join('');
                }
                
                const fullArticlesTarget = $('#full-articles-dynamic-content');
                 if (fullArticlesTarget) {
                    fullArticlesTarget.innerHTML = ALL_POSTS_DATA.map(post => createFullArticleHtml(post)).join('');
                }
                handleMainRouteChange();
            } catch (error) {
                console.error("Failed to load or render posts:", error);
                if ($('#home-recent-writings-grid')) $('#home-recent-writings-grid').innerHTML = '<p class="text-text-secondary col-span-full text-center">Could not load recent writings.</p>';
                if ($('#writings-grid-container')) $('#writings-grid-container').innerHTML = '<p class="text-text-secondary col-span-full text-center">Could not load writings.</p>';
            }
        }


        // --- All other JS functions (Rotating Text, Menu, Scroll, Image Click, Card Hovers, Scroll Animations, Router, Secret Game etc.) remain the same ---
        // Paste them here from the previous response.
        function setupRotatingText(elementId, config) { /* ... (same as previous version, ensure it targets correct IDs) ... */ 
            if (rotatingTextInstances[elementId]) { return; }
            const element = document.getElementById(elementId);
            if (!element) { return; }
            let currentIndex = -1, isBusy = false, cycleTimeout = null, isVisible = false;
            const runOnce = (elementId === 'typewriter');
            element.textContent = ''; 
            function typeWriterInternal(text, callback) {
                let i = 0; isBusy = true;
                function type() {
                    if (!isVisible || !isBusy) { isBusy = false; if (!isVisible) element.textContent = ''; return; }
                    if (i < text.length) {
                        element.textContent += text.charAt(i); i++;
                        setTimeout(type, config.typeSpeed);
                    } else {
                        if (element.querySelector('.typed-cursor')) element.removeChild(element.querySelector('.typed-cursor'));
                        const cursor = document.createElement('span'); cursor.className = 'typed-cursor'; element.appendChild(cursor);
                        isBusy = false; if (callback) callback();
                    }
                } type();
            }
            function deleteWriterInternal(callback) {
                if (runOnce && element.textContent.length > 0) { if (callback) callback(); return; }
                let text = element.textContent;
                const existingCursor = element.querySelector('.typed-cursor');
                if (existingCursor) element.removeChild(existingCursor);
                text = element.textContent; 
                let i = text.length; isBusy = true;
                function del() {
                    if (!isVisible || !isBusy) { isBusy = false; if (!isVisible) element.textContent = ''; return; }
                    if (i > 0) {
                        element.textContent = text.substring(0, i - 1); i--;
                        if (!element.querySelector('.typed-cursor') && element.textContent.length > 0) {
                           const cursor = document.createElement('span'); cursor.className = 'typed-cursor'; element.appendChild(cursor);
                        } setTimeout(del, config.deleteSpeed);
                    } else {
                        const finalCursor = element.querySelector('.typed-cursor'); if (finalCursor) element.removeChild(finalCursor);
                        element.textContent = ''; isBusy = false; if (callback) callback();
                    }
                } del();
            }
            function scheduleCycle(delay) { if (runOnce) return; clearTimeout(cycleTimeout); cycleTimeout = setTimeout(() => { if(isVisible) startCycle(); }, delay); }
            function startCycle() {
                if (runOnce || isBusy || !isVisible) return;
                deleteWriterInternal(() => {
                    if (!isVisible) return; let nextIndex;
                    do { nextIndex = Math.floor(Math.random() * config.texts.length); }
                    while (nextIndex === currentIndex && config.texts.length > 1);
                    currentIndex = nextIndex; const nextText = config.texts[currentIndex];
                    element.textContent = ''; typeWriterInternal(nextText, () => scheduleCycle(config.pauseDuration));
                });
            }
            let initialized = false;
            const intersectionObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const wasVisible = isVisible; isVisible = entry.isIntersecting;
                    if (isVisible && !wasVisible) {
                        if (!initialized) {
                            initialized = true;
                            currentIndex = runOnce ? 0 : (elementId === 'main-heading-text' ? 0 : Math.floor(Math.random() * config.texts.length));
                            const firstText = config.texts[currentIndex];
                            element.textContent = ''; typeWriterInternal(firstText, () => { if (!runOnce) scheduleCycle(config.pauseDuration); });
                        } else { 
                            if (!isBusy) {
                                if (runOnce) { if(element.textContent === '') { element.textContent = ''; typeWriterInternal(config.texts[0], () => {}); }
                                } else { element.textContent = ''; scheduleCycle(100); }
                            }
                        }
                    } else if (!isVisible && wasVisible) { clearTimeout(cycleTimeout); isBusy = false; }
                });
            }, { threshold: 0.1 });
            intersectionObserver.observe(element);
            rotatingTextInstances[elementId] = { observer: intersectionObserver, element: element };
        }
        function setupMobileMenu() { 
            const navToggle = $('#nav-toggle'); const mobileMenu = $('#mobile-menu');
            if (navToggle && mobileMenu) {
                navToggle.addEventListener('click', () => { const isOpen = mobileMenu.classList.toggle('is-open'); navToggle.setAttribute('aria-expanded', String(isOpen)); });
                $$('#mobile-menu a').forEach(link => { link.addEventListener('click', () => { mobileMenu.classList.remove('is-open'); navToggle.setAttribute('aria-expanded', 'false'); }); });
            }
        }
        function setupScrollProgressBar() { 
            const progressBar = $("#progressBar"); if (!progressBar) return;
            window.addEventListener('scroll', () => { const winScroll = document.body.scrollTop || document.documentElement.scrollTop; const height = document.documentElement.scrollHeight - document.documentElement.clientHeight; const scrolled = height > 0 ? (winScroll / height) * 100 : 0; progressBar.style.width = scrolled + "%"; }, { passive: true });
        }
        function setupStaticImageClick() {
            const imageElement = $('#staticImageHome'); if (!imageElement) return;
            const videoUrls = [ 'https://www.youtube.com/watch?v=dQw4w9WgXcQ', 'https://www.youtube.com/watch?v=-jGBp5HBLFs', 'https://www.youtube.com/shorts/2Dv2hO3rYVg', 'https://www.youtube.com/watch?v=x6YcdgB9e48', 'https://www.youtube.com/shorts/D-kkjR0NyGg', 'https://www.youtube.com/shorts/LFsS-9lT0Rk', 'https://www.youtube.com/shorts/TTU1g8IU22I' ];
            imageElement.addEventListener('click', () => { const randomIndex = Math.floor(Math.random() * videoUrls.length); window.open(videoUrls[randomIndex], '_blank'); });
        }
        function setupHomeCardHoverEffects() { 
             $$('#home-content .card').forEach(card => {
                card.addEventListener('mousemove', (e) => { const rect = card.getBoundingClientRect(); const x = e.clientX - rect.left; const y = e.clientY - rect.top; const centerX = rect.width / 2; const centerY = rect.height / 2; const rotateX = (y - centerY) / 20; const rotateY = (centerX - x) / 20; card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateZ(20px)`; });
                card.addEventListener('mouseleave', () => { card.style.transform = 'perspective(1000px) rotateX(0deg) rotateY(0deg) translateZ(0px)'; });
                card.querySelectorAll('a').forEach(link => { link.addEventListener('click', (e) => e.stopPropagation()); });
            });
        }
        function setupHomeScrollAnimations() { 
             const observerOptions = { threshold: 0.1, rootMargin: '0px 0px -30px 0px' };
             const observer = new IntersectionObserver((entries, obs) => {
                 entries.forEach(entry => {
                     const isRotatingText = Object.keys(APP_CONFIG.ROTATING_TEXT_HOME).includes(entry.target.id);
                     if (entry.isIntersecting) { if (!isRotatingText) { entry.target.style.opacity = '1'; entry.target.style.transform = entry.target.dataset.initialTransform || 'translateY(0)'; obs.unobserve(entry.target); } }
                 });
             }, observerOptions);
             const heroSection = $('#heroSection'); if (heroSection) { heroSection.style.opacity = '0'; heroSection.style.transform = 'translateY(20px)'; heroSection.dataset.initialTransform = 'translateY(0)'; heroSection.style.transition = 'opacity 0.8s ease-out, transform 0.8s ease-out'; observer.observe(heroSection); }
             const writingsSectionHome = $('#writingsSectionHome'); if (writingsSectionHome) { writingsSectionHome.style.opacity = '0'; writingsSectionHome.style.transform = 'translateY(20px)'; writingsSectionHome.dataset.initialTransform = 'translateY(0)'; writingsSectionHome.style.transition = 'opacity 0.8s ease-out, transform 0.8s ease-out'; observer.observe(writingsSectionHome); }
             $$('#home-content .card').forEach(card => { 
                 const delay = parseInt(card.getAttribute('data-delay')) || 0; card.style.opacity = '0'; card.style.transform = 'perspective(1000px) rotateX(10deg) rotateY(10deg) translateZ(-20px)'; card.dataset.initialTransform = 'perspective(1000px) rotateX(0deg) rotateY(0deg) translateZ(0px)'; card.style.transition = `opacity 0.8s ease-out ${delay}ms, transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) ${delay}ms`; observer.observe(card);
             });
        }
        function animateProfileSideImage() { // Renamed from animateProfileBGImage
            const heroImageContainer = $('#home-hero-image-container');
            if (heroImageContainer) {
                // CSS handles initial opacity: 0;
                setTimeout(() => { heroImageContainer.style.opacity = '1'; }, 600); // Delay after hero text animation starts
            }
        }
        let currentMainSection = null;
        let lastClickedReadMoreLink = null;
        function showMainSection(sectionId) {
            const previouslyActiveSection = $('.page-section.active-section');
            if (previouslyActiveSection) previouslyActiveSection.classList.remove('active-section');
            const targetSection = $(`#${sectionId}`);
            if (targetSection) {
                targetSection.classList.add('active-section');
                currentMainSection = sectionId;
                $$('.desktop-nav a, .mobile-menu a').forEach(navLink => {
                    navLink.classList.remove('active');
                    const navTarget = navLink.getAttribute('href').substring(1);
                    if ((sectionId === 'home-content' && navTarget === 'home') || (sectionId === 'writings-content' && navTarget === 'writings')) {
                        navLink.classList.add('active');
                    }
                });
                if (sectionId === 'home-content') {
                    animateProfileSideImage(); // Use new animation function
                    for (const elId in APP_CONFIG.ROTATING_TEXT_HOME) {
                        setupRotatingText(elId, APP_CONFIG.ROTATING_TEXT_HOME[elId]);
                    }
                }
                window.scrollTo({ top: 0, behavior: 'auto' });
            }
        }
        function handleMainRouteChange() { /* ... (same as previous version) ... */ 
            let mainSectionTarget = 'home-content';
            let articleDetailHash = '';
            const currentFullHash = window.location.hash;

            if (currentFullHash.startsWith('#post-')) {
                mainSectionTarget = 'writings-content'; articleDetailHash = currentFullHash;
            } else if (currentFullHash === '#writings') {
                mainSectionTarget = 'writings-content';
            } else if (currentFullHash === '#home' || !currentFullHash) {
                mainSectionTarget = 'home-content'; if (!currentFullHash) window.location.hash = 'home';
            } else { window.location.hash = 'home'; return; }

            if (currentMainSection !== mainSectionTarget) showMainSection(mainSectionTarget);
            
            if (mainSectionTarget === 'writings-content') {
                handleWritingsArticleLogic(articleDetailHash);
            } else { document.title = APP_CONFIG.DEFAULT_TITLES.home; }
        }
        function handleWritingsArticleLogic(articleHash) { 
            const defaultWritingsTitle = APP_CONFIG.DEFAULT_TITLES.writings;
            if (articleHash && articleHash.startsWith('#post-')) {
                const targetId = articleHash.substring(1);
                const targetArticle = $(`#${targetId}`);
                if (targetArticle) {
                    const titleElement = targetArticle.querySelector('h2');
                    const articleTitle = titleElement ? titleElement.textContent.trim() : "Article";
                    document.title = `${articleTitle} - Writings - Agraj Dubey`;
                    setTimeout(() => {
                        if (!isElementInViewport(targetArticle)) targetArticle.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        const heading = targetArticle.querySelector('h2');
                        if (heading) { heading.setAttribute('tabindex', '-1'); heading.focus({ preventScroll: true }); }
                    }, 100);
                } else { document.title = defaultWritingsTitle; }
            } else {
                document.title = defaultWritingsTitle;
                const grid = $('#writings-grid-container');
                if (grid && lastClickedReadMoreLink) {
                    setTimeout(() => {
                        if (document.body.contains(lastClickedReadMoreLink)) lastClickedReadMoreLink.focus({preventScroll: true});
                        else if (grid) { grid.setAttribute('tabindex', '-1'); grid.focus({preventScroll: true}); }
                        if (grid && !isElementInViewport(grid)) grid.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 50);
                } lastClickedReadMoreLink = null;
            }
        }
        function isElementInViewport(el) { 
            if(!el) return false; const rect = el.getBoundingClientRect();
            return (rect.top >= 0 && rect.left >= 0 && rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) && rect.right <= (window.innerWidth || document.documentElement.clientWidth));
        }
        function setupSecretGame() { /* ... (same as previous version) ... */ 
            const trigger = $('#secret-game-trigger'); const modal = $('#secret-game-modal'); const canvas = $('#matter-canvas'); const closeButton = $('#close-game-button');
            if (!trigger || !modal || !canvas || !closeButton || typeof Matter === 'undefined') { if(trigger) trigger.style.display = 'none'; return; }
            const Engine = Matter.Engine, Render = Matter.Render, Runner = Matter.Runner, Bodies = Matter.Bodies, Composite = Matter.Composite, Mouse = Matter.Mouse, MouseConstraint = Matter.MouseConstraint;
            trigger.addEventListener('click', () => {
                modal.style.display = 'flex';
                if (matterRender) Matter.Render.stop(matterRender); if (matterEngine) Matter.Engine.clear(matterEngine); if (canvas.firstChild) canvas.removeChild(canvas.firstChild);
                matterEngine = Engine.create({ gravity: { y: 0.6 } }); const world = matterEngine.world;
                let canvasWidth = Math.min(window.innerWidth * 0.8, 600); let canvasHeight = Math.min(window.innerHeight * 0.7, 400);
                matterRender = Render.create({ canvas: canvas, engine: matterEngine, options: { width: canvasWidth, height: canvasHeight, wireframes: false, background: 'transparent' } });
                const ground = Bodies.rectangle(canvasWidth / 2, canvasHeight - 10, canvasWidth, 20, { isStatic: true, render: { fillStyle: '#9272CE' } });
                const leftWall = Bodies.rectangle(10, canvasHeight/2, 20, canvasHeight, {isStatic: true, render: {fillStyle: '#9272CE'}});
                const rightWall = Bodies.rectangle(canvasWidth-10, canvasHeight/2, 20, canvasHeight, {isStatic: true, render: {fillStyle: '#9272CE'}});
                Composite.add(world, [ground, leftWall, rightWall]);
                for (let i = 0; i < 15; i++) { const x = Math.random() * (canvasWidth - 60) + 30; const y = Math.random() * (canvasHeight / 2); const sides = Math.floor(Math.random() * 3) + 3; const radius = Math.random() * 20 + 10; const color = ['#CBB8E8', '#AE8BD5', '#FFFFFF'][Math.floor(Math.random() * 3)]; let body; if (sides === 3 && Math.random() > 0.5) { body = Bodies.circle(x, y, radius, { render: { fillStyle: color } }); } else { body = Bodies.polygon(x, y, sides, radius, { render: { fillStyle: color } }); } Composite.add(world, body); }
                const mouse = Mouse.create(matterRender.canvas); const mouseConstraint = MouseConstraint.create(matterEngine, { mouse: mouse, constraint: { stiffness: 0.2, render: { visible: false } } });
                Composite.add(world, mouseConstraint); matterRender.mouse = mouse;
                Render.run(matterRender); const runner = Runner.create(); Runner.run(runner, matterEngine);
            });
            closeButton.addEventListener('click', () => { modal.style.display = 'none'; if (matterRender) Matter.Render.stop(matterRender); if (matterEngine) Matter.Engine.clear(matterEngine); });
        }

        // --- DOMContentLoaded Initializations ---
        document.addEventListener('DOMContentLoaded', async () => {
            resizeHyperspeedCanvas(); initStars(); animateHyperspeed();
            window.addEventListener('resize', resizeHyperspeedCanvas);
            setupMobileMenu(); setupScrollProgressBar();
            await loadAndRenderPosts(); 
            setupStaticImageClick();
            // setupHomeScrollAnimations() is called within loadAndRenderPosts if homeGrid exists.
            handleMainRouteChange();
            window.addEventListener('hashchange', handleMainRouteChange);
            const currentYearEl = $('#currentYear');
            if(currentYearEl) currentYearEl.textContent = new Date().getFullYear();
            setupSecretGame();
        });
    </script>
</body>
</html>
