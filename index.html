<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>agraj - Portfolio</title>
    <link rel="icon" type="image/png" href="frieren.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+Bhai+2:wght@700&family=Inter:wght@400;500;600;700&family=Lato:ital,wght@0,400;0,700;1,400&family=Outfit:wght@400;500;700&family=Nunito:wght@400;700&family=Fuzzy+Bubbles:wght@400;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>

    <script>
        window.tailwind.config = {
            theme: {
                extend: {
                    colors: { // These are mostly for cards which retain their dark theme
                        'brand-purple': '#9272CE',
                        'brand-purple-light': '#AE8BD5',
                        'brand-purple-lighter': '#CBB8E8',

                        // Text for main content (on black bg)
                        'text-on-black-primary': '#EAEAEA',
                        'text-on-black-secondary': '#B0B0B0',
                        'text-on-black-tertiary': '#888888',

                        // Navbar specific (on light grey bg)
                        'nav-text-dark': '#222222',
                        'nav-text-dark-subtle': '#555555',
                        'nav-bg-light-grey': '#E9E9E9',
                        'nav-quote-bg-on-light': '#DDDDDD',

                        // Original dark theme card colors (preserved for Writings/About sections)
                        'article-bg': 'rgba(20, 20, 22, 0.93)', 
                        'writings-card-bg': 'rgba(25, 15, 40, 0.88)',
                        'writings-card-hover-bg': 'rgba(45, 35, 60, 0.96)',
                        
                        'correct-answer-bg': 'rgba(146, 114, 206, 0.35)', 
                        'selected-wrong-bg': 'rgba(100, 100, 100, 0.3)', 
                        'disabled-option-bg': 'rgba(30, 20, 50, 0.7)',
                    },
                    fontFamily: { 
                        sans: ['Inter', 'sans-serif'], serif: ['Baloo Bhai 2', 'cursive'],
                        lato: ['Lato', 'sans-serif'], outfit: ['Outfit', 'sans-serif'],
                        nunito: ['Nunito', 'sans-serif'], 'fuzzy-bubbles': ['Fuzzy Bubbles', 'cursive'],
                    },
                }
            }
        };
    </script>

    <style>
        :root {
            --page-bg: #000000; /* Absolute black for main content */
            --text-main: var(--text-on-black-primary, #EAEAEA); /* Text on black background */
            --text-subtle: var(--text-on-black-secondary, #B0B0B0);
            
            --highlight-purple: #9272CE;
            --highlight-purple-hover: #AE8BD5;
            --highlight-purple-lighter: #CBB8E8;

            --nav-bg: var(--nav-bg-light-grey, #E9E9E9); /* Light grey for navbar */
            --nav-text: var(--nav-text-dark, #222222); /* Dark text for navbar content */
            --nav-text-subtle: var(--nav-text-dark-subtle, #555555);
            --nav-quote-bg: var(--nav-quote-bg-on-light, #DDDDDD);
            --nav-link-hover-bg: rgba(146, 114, 206, 0.1); /* Subtle purple hover on light grey */

            /* p5 background & overlay for the black main page */
            --p5-blob-hue-min: 230; /* Purplish hues */
            --p5-blob-hue-max: 310;
            --p5-blob-opacity: 4; /* Subtle on black */
            --bg-overlay-color-1: rgba(146, 114, 206, 0.02); /* very faint purple */
            --bg-overlay-color-2: rgba(0, 0, 0, 0.85); /* fading to black */

            /* Preserved dark card styles from original */
            --article-bg-color: rgba(20, 20, 22, 0.93);
            --writings-card-bg-color: rgba(25, 15, 40, 0.88);
            --writings-card-hover-bg-color: rgba(45, 35, 60, 0.96);
            --card-border-color: rgba(146, 114, 206, 0.25);
            --card-hover-border-color: rgba(146, 114, 206, 0.45);
        }

        html { scroll-behavior: smooth; }
        body {
            background-color: var(--page-bg); color: var(--text-main); font-family: 'Inter', sans-serif;
            overflow-x: hidden; line-height: 1.6; font-size: 16px;
        }
        
        #p5-background-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -10; }
        .bg-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 50% 30%, var(--bg-overlay-color-1), var(--bg-overlay-color-2) 70%); z-index: -5; pointer-events:none; }
        
        .site-container { display: flex; min-height: 100vh; }

        .site-navbar {
            width: 38.2vw; /* Golden Ratio proportion */
            min-width: 300px; /* Minimum width for usability */
            max-width: 550px; /* Maximum width to prevent excessive size on very large screens */
            background-color: var(--nav-bg);
            border-right: 1px solid #CCCCCC; /* Slightly darker border for light grey */
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            padding: 2.5rem calc(2.5rem / 1.618); /* Vertical padding and GR horizontal padding */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            overflow-y: auto;
            z-index: 100;
        }
        .navbar-top-content { text-align: center; }
        #navbar-agraj-image {
            width: 70%; /* Relative to navbar width */
            max-width: 220px; /* Max pixel width */
            height: auto;
            margin: 0 auto 1rem;
            display: block;
            /* If agraj.png has a black background, it will show as a black rectangle here */
        }
        
        .site-navbar #typewriter {
            min-height: 2.5em; font-size: 0.95rem; color: var(--nav-text-subtle); margin-bottom: 1rem;
            display: inline-block; width: 100%;
        }
        .site-navbar #main-heading-text { min-height: 1.2em; display: inline-block; }
        .site-navbar #blockquote-text { min-height: 3em; display: inline-block; font-size: 0.9rem; }
        .site-navbar .typed-cursor { background-color: var(--highlight-purple); }

        .site-navbar .quote {
            position: relative; border-left: 3px solid var(--highlight-purple); margin-top: 1rem; margin-bottom: 2rem;
            background-color: var(--nav-quote-bg); 
            padding: 0.75rem 1rem; border-radius: 0.375rem; font-size: 0.9rem; color: var(--nav-text-subtle);
        }
        .site-navbar .quote::before {
            content: '"'; position: absolute; top: -10px; left: 5px; font-size: 3rem; 
            color: color-mix(in srgb, var(--nav-text-subtle) 15%, transparent);
            font-family: 'Inter', sans-serif; font-weight: 700;
        }

        .navbar-links a {
            display: block;
            padding: 0.85rem calc(0.85rem * 1.618); /* Golden Ratio padding */
            margin-bottom: 0.5rem;
            text-decoration: none;
            color: var(--nav-text);
            font-weight: 500;
            border-radius: 0.375rem;
            transition: background-color 0.2s ease, color 0.2s ease;
            font-size: 1.1rem;
        }
        .navbar-links a:hover {
            background-color: var(--nav-link-hover-bg);
            color: var(--highlight-purple);
        }
        .navbar-links a.active {
            background-color: var(--highlight-purple);
            color: white !important; 
            font-weight: 700;
        }
        .navbar-links a[target="_blank"]::after {
            content: ' \2197'; font-size: 0.7em; vertical-align: super; 
            display: inline-block; margin-left: 2px; opacity: 0.7;
        }

        .navbar-bottom { text-align: center; margin-top:1rem; }
        #navbar-logo-image {
            width: 60px; 
            height: auto;
            margin: 1.5rem auto 0; /* Added top margin */
            cursor: pointer; 
            display: block;
            opacity: 0.8;
            transition: opacity 0.2s ease;
        }
        #navbar-logo-image:hover { opacity: 1; }

        .site-content {
            margin-left: 38.2vw; 
            width: calc(100% - 38.2vw);
            padding: 2rem; 
            background-color: var(--page-bg); /* Should be black */
        }
        /* Adjust margin-left if navbar hits min/max width */
        @media (max-width: calc(300px / 0.382)) { /* Approx 785px: when navbar hits 300px min-width */
            .site-content { margin-left: 300px; width: calc(100% - 300px); }
        }
        @media (min-width: calc(550px / 0.382)) { /* Approx 1440px: when navbar hits 550px max-width */
            .site-content { margin-left: 550px; width: calc(100% - 550px); }
        }


        .page-section { display: none; animation: fadeInPage 0.7s ease-out forwards; }
        .page-section.active-section { display: block; }
        @keyframes fadeInPage { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        h1, h2, h3, h4, h5, h6 { 
            color: var(--highlight-purple); 
            font-weight: 700; 
        }
        .font-serif { font-family: 'Baloo Bhai 2', cursive; }
        .font-outfit { font-family: 'Outfit', sans-serif; }
        
        ::-webkit-scrollbar { width: 8px; } /* Slightly wider for better grab */
        ::-webkit-scrollbar-track { background: color-mix(in srgb, var(--nav-bg) 70%, transparent); } 
        ::-webkit-scrollbar-thumb { background: color-mix(in srgb, var(--highlight-purple) 60%, transparent); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: color-mix(in srgb, var(--highlight-purple) 80%, transparent); }

        #animated-images-container-wrapper {
            height: calc(100vh - 4rem); 
            position: relative;
        }
        #animated-images-container {
            position: relative; width: 100%; height: 100%; 
        }
        .animated-post-image-bubble {
            position: absolute; border-radius: 50%; overflow: hidden;
            box-shadow: 0 5px 20px color-mix(in srgb, var(--highlight-purple) 20%, #000000 50%), 0 0 8px rgba(0,0,0,0.2); /* Adjusted shadow for black bg */
            border: 2px solid color-mix(in srgb, var(--highlight-purple-lighter) 30%, transparent); 
            transition: border-color 0.3s ease; opacity: 0;
        }
        .animated-post-image-bubble:hover {
            border-color: color-mix(in srgb, var(--highlight-purple-hover) 70%, transparent); 
        }
        .animated-post-image-bubble img {
            width: 100%; height: 100%; object-fit: cover; display: block;
        }

        /* Writings & About Section Styles - Keeping original dark card aesthetic */
        #writings-content, #about-content { font-size: 17px; }
        /* ... (All .writing-preview-card, #full-articles-container, .post-content-html styles from previous response are largely unchanged as they define the dark cards themselves) ... */
        /* Ensured card text is light, and card backgrounds are dark as per original */
         .writing-preview-card { 
            background-color: var(--writings-card-bg-color); 
            backdrop-filter: blur(7px); border-radius: 0.75rem; padding: 2rem; 
            border: 1px solid var(--card-border-color); 
            display: flex; flex-direction: column; 
            box-shadow: 0 6px 18px rgba(0,0,0, 0.35), 0 0 8px 1px color-mix(in srgb, var(--highlight-purple) 20%, transparent);
            position: relative; overflow: hidden;   
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), 
                        box-shadow 0.4s ease-out, border-color 0.4s ease-out,
                        background-color 0.3s ease;
        }
        .writing-preview-card::before { 
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, color-mix(in srgb, var(--highlight-purple) 10%, transparent), transparent);
            transform: translateX(-100%); transition: transform 0.8s ease;
            pointer-events: none; z-index: 0; 
        }
        .writing-preview-card:hover { 
            background-color: var(--writings-card-hover-bg-color); 
            box-shadow: 0 15px 30px rgba(0,0,0, 0.5), 0 0 20px color-mix(in srgb, var(--highlight-purple) 35%, transparent); 
            border-color: var(--card-hover-border-color); 
        }
        .writing-preview-card:hover::before { transform: translateX(100%); }
        .writing-preview-card h3 { color: #FFFFFF; font-size: 1.55rem; } /* This H3 is inside dark card */
        .writing-preview-card .post-meta-info { color: var(--highlight-purple-lighter); }
        .writing-preview-card .excerpt { color: #D1D1D1; }
        .writing-preview-card a.read-more-link { color: var(--highlight-purple); }
        .writing-preview-card a.read-more-link:hover { color: var(--highlight-purple-hover); }
        
        #full-articles-container article { 
            background-color: var(--article-bg-color); 
            border: 1px solid var(--card-border-color); 
            border-top: 5px solid var(--highlight-purple);
             /* ... other styles from previous */
        }
        #full-articles-container article:target { display: block !important; opacity: 1 !important; animation: fadeInArticle 0.6s ease-out forwards; }
        #full-articles-container .post-meta-info { color: var(--highlight-purple-lighter); }
        a.back-button { background-color: var(--highlight-purple); color: #FFFFFF; }
        a.back-button:hover { background-color: var(--highlight-purple-hover); }
        hr.separator { background-image: linear-gradient(to right, transparent, var(--highlight-purple), var(--highlight-purple-hover), var(--highlight-purple), transparent); }
        
        .post-content-html p, .post-content-html span, .post-content-html div, 
        .post-content-html b, .post-content-html strong, .post-content-html i, 
        .post-content-html em, .post-content-html u { 
             color: #D1D1D1; /* Light text for dark cards */
        }
        .post-content-html a { color: var(--highlight-purple); } 
        .post-content-html a:hover { color: var(--highlight-purple-hover); }
        .post-content-html blockquote { 
            border-left: 4px solid var(--highlight-purple); color: #A8A8A8; 
            background-color: rgba(146, 114, 206, 0.05); 
        }
        
        /* Glitch Button styling is preserved */
        .glitch-button { /* ... */ }

        .progress-container { position: fixed; top: 0; left: 0; width: 100%; height: 3px; z-index: 200; }
        .progress-bar { height: 3px; background: linear-gradient(90deg, var(--highlight-purple), var(--highlight-purple-hover)); width: 0%; }

        #secret-game-modal { 
            background-color: rgba(0,0,0,0.97); /* Darker overlay for black bg */
            /* ... other styles from previous, should largely work */
        }
        #matter-canvas { 
            background-color: rgba(20, 15, 35, 0.4); /* Slightly more transparent for black bg */
            /* ... */
        }
        #game-info { color: var(--highlight-purple-lighter); }
        #game-win-message { color: var(--highlight-purple-hover); }
        .game-instructions { color: var(--text-on-black-secondary); }


        /* About Section Questionnaire Styles (Preserved dark cards) */
        #about-content .questionnaire-container-wrapper { /* ... */ }
        .question-block { background-color: rgba(28, 18, 52, 0.85); /* ... */ }
        .question-block h3 { color: #D7C2F2; /* This H3 is inside dark card */ }
        .answer-option { background-color: rgba(45, 30, 70, 0.8); color: #E0D8F0; /* ... */ }
        .feedback-area { background-color: rgba(15, 10, 30, 0.9); color: #D7C2F2; /* ... */ }
        #personality-match-section { background-color: rgba(35, 25, 60, 0.9); /* ... */ }
        #personality-match-section h2 { color: var(--highlight-purple-lighter); /* This H2 is inside dark card */ }
        #personality-match-section p { color: #E0D8F0; }


        @media (max-width: 768px) {
            .site-navbar {
                width: 100%;
                height: auto; /* Allow content to push it */
                max-height: 50vh; /* Limit height on mobile, rest scrollable */
                position: static; 
                border-right: none;
                border-bottom: 1px solid #CCCCCC;
                padding: 1.5rem 1rem; /* Adjusted padding for mobile */
                min-width: unset; max-width: unset;
            }
            #navbar-agraj-image { width: 50%; max-width: 150px; margin-bottom: 0.5rem;}
            .site-navbar #typewriter, .site-navbar .quote { font-size: 0.8rem; margin-bottom: 0.5rem; margin-top: 0.5rem; }
            .navbar-links a { padding: 0.6rem 1rem; font-size: 1rem; }
            #navbar-logo-image { width: 45px; margin-top: 1rem; }

            .site-content {
                margin-left: 0;
                width: 100%;
                padding: 1.5rem 1rem; /* Consistent padding */
            }
            #animated-images-container-wrapper {
                height: 60vh; 
            }
            .progress-container { display: none; } /* Optional: hide progress on mobile */
        }

    </style>
</head>
<body>
    <audio id="gameSpawnSound" src="spawn_sound.mp3" preload="auto"></audio>
    <audio id="gameWinSound" src="win_sound.mp3" preload="auto"></audio>
    <audio id="revealSound" src="reveal_sound.mp3" preload="auto"></audio>

    <div id="p5-background-canvas"></div>
    <div class="progress-container"> <div class="progress-bar" id="progressBar"></div> </div> 
    <div class="bg-overlay"></div>

    <div class="site-container">
        <aside class="site-navbar">
            <div class="navbar-top-content">
                <a href="#home" aria-label="Go to Home Page">
                    <img src="agraj.png" alt="Agraj stylized text logo" id="navbar-agraj-image">
                </a>
                <h1 class="text-2xl md:text-3xl font-bold mb-3 tracking-tight font-serif sr-only"> 
                    <span id="main-heading-text"></span>
                </h1> 
                <p id="typewriter" class="mb-4"></p> 
                <blockquote class="quote"> 
                    "<span id="blockquote-text"></span>" 
                </blockquote>
            </div>
            
            <nav class="navbar-links">
                <a href="#home" data-navlink="home" class="active">Home</a> 
                <a href="#writings" data-navlink="writings">Writings</a> 
                <a href="#about" data-navlink="about">About Me</a> 
                <a href="https://www.reddit.com/user/Federal_Anywhere_559/" target="_blank" rel="noopener noreferrer" data-navlink="reddit">Reddit</a>
                <a href="https://t.me/agraj0669" target="_blank" rel="noopener noreferrer" data-navlink="contact">Contact Me</a> 
            </nav>

            <div class="navbar-bottom">
                <!-- Dark mode toggle button removed -->
                <img src="logo.png" alt="Agraj personal logo" id="navbar-logo-image" title="Play a game?">
            </div>
        </aside>

        <main class="site-content">
            <div id="page-container">
                <section id="home-content" class="page-section">
                    <div id="animated-images-container-wrapper">
                        <div id="animated-images-container">
                            <!-- Bubbles will be injected by JS -->
                        </div>
                    </div>
                </section>
                
                <section id="writings-content" class="page-section"> 
                    <div class="text-center mb-12 md:mb-16 pt-8"> 
                        <h1 class="text-4xl md:text-5xl font-bold font-outfit">My Writings</h1> 
                    </div> 
                    <section id="writings-grid-container" class="mb-12 md:mb-20 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8"></section> 
                    <hr class="separator"> 
                    <section id="full-articles-container"> 
                        <div class="full-articles-content max-w-4xl mx-auto" id="full-articles-dynamic-content"></div> 
                    </section> 
                </section>
        
                <section id="about-content" class="page-section">
                    <div class="text-center mb-12 md:mb-16 pt-8">
                        <h1 class="text-4xl md:text-5xl font-bold font-outfit">A Little More About Me</h1>
                        <p class="text-text-subtle mt-4 text-lg">Answer these questions to see how our perspectives align (or amusingly diverge!).</p>
                    </div>
                    <div id="questionnaire-container-wrapper" class="questionnaire-container-wrapper">
                        <div id="questionnaire-render-area">
                            <p class="text-center text-text-subtle">Loading questions...</p>
                        </div>
                        <div id="personality-match-section" class="mt-12" style="display: none; opacity: 0; transform: translateY(20px);">
                            <h2>Personality Snapshot</h2>
                            <p>Your alignment with my perspectives: <span id="match-percentage-value">0</span>%</p>
                            <p>My MBTI Type: <span id="mbti-type-value">INFJ</span></p>
                            <p class="text-sm text-text-tertiary mt-4">Note: This is a simplified alignment based on these specific questions.</p>
                            <a href="https://t.me/agraj0669" target="_blank" rel="noopener noreferrer" id="contact-telegram-btn" class="glitch-button mt-6" data-text="Contact on Telegram!">
                                <span class="btn-text">Contact on Telegram!</span>
                            </a>
                        </div>
                        <div class="text-center">
                             <button id="calculate-match-button" class="glitch-button" data-text="See How We Match!" style="display: none;"><span class="btn-text">See How We Match!</span></button>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>
    
    <div id="secret-game-modal">
        <div id="game-info">
            <p>Shapes dropped: <span id="game-shapes-dropped">0</span>/<span id="game-max-shapes">0</span></p>
            <p>In target: <span id="game-shapes-in-target">0</span>/<span id="game-shapes-to-win">0</span></p>
            <p id="game-win-message" class="game-instructions">Drag shapes into the purple zone!</p>
        </div>
        <canvas id="matter-canvas"></canvas>
        <div class="game-controls">
            <button id="reset-game-button" class="glitch-button" data-text="Reset Game"><span class="btn-text">Reset Game</span></button>
            <button id="close-game-button" class="glitch-button" data-text="Close Game"><span class="btn-text">Close Game</span></button>
        </div>
    </div>

    <script>
        // --- JAVASCRIPT FROM PREVIOUS RESPONSE ---
        // --- Key changes: ---
        // --- 1. Removed setupDarkModeToggle() and its call. ---
        // --- 2. p5.js sketch will now always use the dark-themed CSS vars for blobs. ---
        // --- (The rest of the JS for routing, content loading, game, etc., remains largely the same) ---

        const APP_CONFIG = { /* ... same as previous ... */ };
        let ALL_QUESTIONNAIRE_DATA = [];
        let visitorAnswers = {}; 
        let questionsAnsweredCount = 0;
        let revealSound, gameSpawnSoundEl, gameWinSoundEl;

        function $(selector) { return document.querySelector(selector); }
        function $$(selector) { return document.querySelectorAll(selector); }

        let p5Blobs = [];
        const NUM_P5_BLOBS = 5; 
        function p5Sketch(p) { /* ... same as previous, it reads CSS vars which are now fixed to dark theme ... */
            class Blob {
                constructor() {
                    this.x = p.random(p.width); this.y = p.random(p.height);
                    this.r = p.random(p.width / 3.5, p.width / 1.3); 
                    this.xSpeed = p.random(-0.35, 0.35); this.ySpeed = p.random(-0.35, 0.35); 
                    this.numPoints = p.int(p.random(6, 12));
                    this.noiseSeedX = p.random(1000); this.noiseSeedY = p.random(1000); this.noiseSeedR = p.random(1000); 
                    this.hueMin = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--p5-blob-hue-min'));
                    this.hueMax = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--p5-blob-hue-max'));
                    this.hue = p.random(this.hueMin, this.hueMax);
                    this.hueShiftSpeed = p.random(-0.12, 0.12); 
                    this.opacity = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--p5-blob-opacity'));
                }
                update() {
                    this.x += this.xSpeed + (p.noise(this.noiseSeedX + p.frameCount * 0.0005) - 0.5) * 0.5; 
                    this.y += this.ySpeed + (p.noise(this.noiseSeedY + p.frameCount * 0.0005) - 0.5) * 0.5; 
                    this.r = p.map(p.noise(this.noiseSeedR + p.frameCount * 0.0012), 0, 1, p.width / 4.5, p.width / 1.1); 
                    if (this.x < -this.r * 1.5) this.x = p.width + this.r * 1.5;
                    if (this.x > p.width + this.r * 1.5) this.x = -this.r * 1.5;
                    if (this.y < -this.r * 1.5) this.y = p.height + this.r * 1.5;
                    if (this.y > p.height + this.r * 1.5) this.y = -this.r * 1.5;
                    this.hue = (this.hue + this.hueShiftSpeed);
                    if (this.hue > this.hueMax) this.hue = this.hueMin;
                    if (this.hue < this.hueMin) this.hue = this.hueMax;
                }
                display() {
                    p.fill(this.hue, 60, 70, this.opacity); p.beginShape();
                    let angleStep = p.TWO_PI / this.numPoints;
                    for (let i = 0; i <= this.numPoints; i++) { 
                        let angle = i * angleStep;
                        let radiusOffset = p.map(p.noise(this.noiseSeedX + i * 0.2 + p.frameCount * 0.002, this.noiseSeedY + i * 0.2), 0, 1, -this.r * 0.4, this.r * 0.4);
                        let currentR = this.r + radiusOffset;
                        let vx = this.x + currentR * p.cos(angle); let vy = this.y + currentR * p.sin(angle);
                        p.curveVertex(vx, vy); if (i === 0 || i === 1 || i === this.numPoints-1 || i === this.numPoints) { p.curveVertex(vx, vy); }
                    }
                    p.endShape();
                }
            }
            p.setup = function() {
                const p5CanvasContainer = $('#p5-background-canvas');
                if (!p5CanvasContainer) { console.error("p5 canvas container not found!"); return; }
                const p5Renderer = p.createCanvas(p.windowWidth, p.windowHeight);
                p5Renderer.parent(p5CanvasContainer); p.colorMode(p.HSB, 360, 100, 100, 100); p.noStroke();
                for (let i = 0; i < NUM_P5_BLOBS; i++) { p5Blobs.push(new Blob()); }
            };
            p.draw = function() { p.clear(); for (let blob of p5Blobs) { blob.update(); blob.display(); } };
            p.windowResized = function() {
                p.resizeCanvas(p.windowWidth, p.windowHeight); p5Blobs = [];
                for (let i = 0; i < NUM_P5_BLOBS; i++) { p5Blobs.push(new Blob()); }
            };
        }
        
        let ALL_POST_DATA_FOR_HOME_RECENT = []; let ALL_POSTS_DATA = [];
        function simpleMarkdownToHtml(md) { /* ... same as previous ... */ 
            if (typeof md !== 'string') return ''; let html = md;
            if (html.startsWith('`') && html.endsWith('`') && !html.startsWith('```') && !html.endsWith('```')) { html = html.substring(1, html.length - 1); }
            html = html.replace(/\r\n/g, '\n'); html = html.replace(/<br\s*\/?>\n?/gi, '\n');
            html = html.replace(/\n\s*\n+/g, '<br>\n<br>\n'); html = html.replace(/\n/g, '<br>\n');
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
            html = html.replace(/\\\"/g, '"'); html = html.replace(/(<br>\n\s*){3,}/g, '<br>\n<br>\n'); return html;
        }
        function createPostPreviewCard(post, isForHome = false) { /* ... same as previous ... */ 
            const cardClass = 'writing-preview-card'; const anchorClass = `read-more-link`; 
            const readMoreTextContent = `Read More →`; const dataText = readMoreTextContent.trim();
            return `<div class="${cardClass} rounded-lg p-7 shadow-lg relative overflow-hidden"><h3 class="text-xl lg:text-2xl font-semibold mb-4 group text-hover-scale font-outfit"><span class="transition-all duration-300 inline-block">${post.title}</span></h3><div class="post-meta-info">${new Date(post.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div><div class="mb-5"><p class="excerpt line-clamp-4">${post.excerpt}</p></div><a href="#${post.id}" class="${anchorClass}" data-text="${dataText}"><span class="btn-text">${readMoreTextContent}</span></a></div>`;
        }
        function createFullArticleHtml(post) { /* ... same as previous ... */
             const htmlContent = simpleMarkdownToHtml(post.contentMarkdown); 
            return `<article id="${post.id}" tabindex="-1"><h2 class="text-hover-scale">${post.title}</h2><div class="post-meta-info">Published: ${new Date(post.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>${post.image ? `<img src="${post.image}" alt="${post.imageAlt || post.title}" class="my-8 rounded-lg shadow-lg mx-auto max-w-full md:max-w-2xl" loading="lazy">` : ''}<div class="post-content-html">${htmlContent}</div><a href="#writings" class="back-button mt-8 glitch-button" data-text="← Back to Writings"><span class="btn-text">← Back to Writings</span></a></article>`;
        }
        async function setupHomePageRightColumnImages() { /* ... same as previous ... */ 
            const container = $('#animated-images-container'); const sectionContainer = $('#animated-images-container-wrapper');
            if (!container || !sectionContainer) { console.warn("Animated images container not ready."); return; }
            if (ALL_POSTS_DATA.length === 0) { setTimeout(setupHomePageRightColumnImages, 200); return; }
            const postsWithImages = ALL_POSTS_DATA.filter(post => post.image).slice(0, 5); 
            if (postsWithImages.length === 0) { container.innerHTML = '<p class="text-text-subtle text-sm text-center md:text-left">No recent visual entries.</p>'; return; }
            container.innerHTML = ''; 
            const bubbleConfigs = [ { sizeVW: 18, minSize: 150, maxSize: 250, zIndex: 1 }, { sizeVW: 15, minSize: 130, maxSize: 220, zIndex: 3 }, { sizeVW: 20, minSize: 170, maxSize: 280, zIndex: 2 }, { sizeVW: 16, minSize: 140, maxSize: 230, zIndex: 1 }, { sizeVW: 14, minSize: 120, maxSize: 200, zIndex: 3 }];
            requestAnimationFrame(() => {
                const containerWidth = container.offsetWidth; const containerHeight = container.offsetHeight;
                postsWithImages.forEach((post, index) => {
                    if (index >= bubbleConfigs.length) return; const config = bubbleConfigs[index]; const escapedTitle = post.title.replace(/"/g, '"');
                    let bubbleSize = Math.max(config.minSize, Math.min(config.maxSize, window.innerWidth * (config.sizeVW / 100)));
                    bubbleSize = Math.min(bubbleSize, (containerWidth > 0 ? containerWidth * 0.8 : config.maxSize), (containerHeight > 0 ? containerHeight * 0.40 : config.maxSize));
                    const bubbleLink = document.createElement('a'); bubbleLink.href = `#${post.id}`; bubbleLink.classList.add('animated-post-image-bubble');
                    bubbleLink.setAttribute('aria-label', `Read more about ${escapedTitle}`); bubbleLink.title = escapedTitle;
                    bubbleLink.style.width = `${bubbleSize}px`; bubbleLink.style.height = `${bubbleSize}px`; bubbleLink.style.zIndex = config.zIndex; bubbleLink.style.opacity = 0; 
                    const img = document.createElement('img'); img.src = post.image; img.alt = `Preview for ${escapedTitle}`;
                    bubbleLink.appendChild(img); container.appendChild(bubbleLink);
                });
                const imageBubbles = $$('#animated-images-container .animated-post-image-bubble');
                if (typeof anime === 'function' && imageBubbles.length > 0) {
                    imageBubbles.forEach((bubble) => {
                        function fizzleAnimation() {
                            const bubbleSize = parseFloat(bubble.style.width); const currentContainerHeight = container.offsetHeight > 0 ? container.offsetHeight : 600; const currentContainerWidth = container.offsetWidth > 0 ? container.offsetWidth : 300; 
                            const maxTop = Math.max(0, currentContainerHeight - bubbleSize - 10); const maxLeft = Math.max(0, currentContainerWidth - bubbleSize - 10);
                            const newTop = anime.random(0, maxTop); const newLeft = anime.random(0, maxLeft);
                            bubble.style.top = `${newTop}px`; bubble.style.left = `${newLeft}px`; bubble.style.transform = 'translateX(0px) translateY(0px)';
                            anime.timeline({ targets: bubble, easing: 'easeOutExpo', complete: fizzleAnimation })
                            .add({ opacity: [0, 0.9], scale: [0.3, 1], duration: anime.random(700, 1000), })
                            .add({ translateX: () => anime.random(-20, 20) + 'px', translateY: () => anime.random(-20, 20) + 'px', scale: () => anime.random(0.9, 1.1), duration: anime.random(3000, 5000), easing: 'easeInOutSine' }, '-=300') 
                            .add({ opacity: [bubble.style.opacity, 0], scale: [parseFloat(getComputedStyle(bubble).transform.split(',')[0].split('(')[1]) || 1, 0.2], duration: anime.random(600, 900), easing: 'easeInExpo', delay: anime.random(0, 400) });
                        }
                        setTimeout(fizzleAnimation, anime.random(0, 2500)); 
                    });
                }
            }); 
        }
        async function loadAndRenderPosts() { /* ... same as previous ... */ 
            try {
                const response = await fetch(APP_CONFIG.POSTS_JSON_PATH);
                if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}, path: ${APP_CONFIG.POSTS_JSON_PATH}`); }
                ALL_POSTS_DATA = await response.json(); ALL_POSTS_DATA.sort((a, b) => new Date(b.date) - new Date(a.date)); 
                const writingsGrid = $('#writings-grid-container');
                if (writingsGrid) {
                     if (ALL_POSTS_DATA.length > 0) { writingsGrid.innerHTML = ALL_POSTS_DATA.map(post => createPostPreviewCard(post, false)).join(''); } 
                     else { writingsGrid.innerHTML = '<p class="text-text-subtle col-span-full text-center">No writings available.</p>'; }
                     setupWritingsCardHoverEffects(); 
                }
                const fullArticlesTarget = $('#full-articles-dynamic-content');
                if (fullArticlesTarget) {  fullArticlesTarget.innerHTML = ALL_POSTS_DATA.map(post => createFullArticleHtml(post)).join(''); }
                if (typeof setupHomePageRightColumnImages === 'function') { await setupHomePageRightColumnImages(); }
            } catch (error) {
                console.error("ERROR in loadAndRenderPosts:", error);
                if ($('#writings-grid-container')) $('#writings-grid-container').innerHTML = '<p class="text-text-subtle col-span-full text-center">Error: Could not load writings.</p>';
            }
        }
        
        async function renderQuestionnaire() { /* ... same as previous ... */ }
        function setupQuestionnaireInteractions() { /* ... same as previous ... */ }
        function calculateAndShowMatch() { /* ... same as previous ... */ }

        let matterEngine, matterRender, matterRunner; /* ... (Secret Game JS, same as previous) ... */
        let gameShapes = []; const MAX_SHAPES_TO_SPAWN = 10; const SHAPES_TO_WIN = 3;
        let shapesSpawned = 0; let gameHasBeenWon = false; let targetZoneBody;
        function playSound(soundElement) { if (soundElement && typeof soundElement.play === 'function') { soundElement.currentTime = 0; soundElement.play().catch(e => console.warn("Game sound play failed:", e.message)); } }
        function resetSecretGame() { /* ... */ }
        function updateGameInfoDisplay() { /* ... */ }
        function setupSecretGame() { /* ... (Trigger is #navbar-logo-image) ... */ }
        
        let rotatingTextInstances = {};
        function setupRotatingText(elementId, config) { /* ... same as previous ... */ }
        function setupScrollProgressBar() { /* ... same as previous ... */ }
        function setupWritingsCardHoverEffects() { /* ... same as previous ... */ }
        
        let currentMainSection = null; let lastClickedReadMoreLink = null; 
        function showMainSection(sectionId) { /* ... same as previous (nav link selector is .site-navbar .navbar-links a) ... */ }
        function handleMainRouteChange() { /* ... same as previous (nav link selector is .site-navbar .navbar-links a) ... */ }
        function handleWritingsArticleLogic(articleHash) { /* ... same as previous ... */ }
        function isElementInViewport(el) { /* ... same as previous ... */ }
        
        document.addEventListener('DOMContentLoaded', async () => {
            revealSound = $('#revealSound'); gameSpawnSoundEl = $('#gameSpawnSound'); gameWinSoundEl = $('#gameWinSound');
            if (typeof p5 !== 'undefined') { new p5(p5Sketch); } else { console.error("p5.js is not loaded!"); }
            // No setupDarkModeToggle() call
            setupScrollProgressBar();
            await loadAndRenderPosts(); 
            for (const elId in APP_CONFIG.ROTATING_TEXT_HOME) {
                if (document.getElementById(elId) && typeof setupRotatingText === 'function') { 
                     setupRotatingText(elId, APP_CONFIG.ROTATING_TEXT_HOME[elId]);
                }
            }
            document.body.addEventListener('click', function(event) {
                const clickedLink = event.target.closest('a.glitch-button[href^="#post-"], a.read-more-link[href^="#post-"]');
                if (clickedLink) { lastClickedReadMoreLink = clickedLink; }
            });
            handleMainRouteChange(); 
            window.addEventListener('hashchange', handleMainRouteChange); 
            setupSecretGame(); 
             window.addEventListener('resize', () => {
                if (currentMainSection === 'home-content' && typeof setupHomePageRightColumnImages === 'function') {
                    clearTimeout(window.resizeHomeImagesTimeout);
                    window.resizeHomeImagesTimeout = setTimeout(setupHomePageRightColumnImages, 250);
                }
            });
        });
    </script>
</body>
</html>
